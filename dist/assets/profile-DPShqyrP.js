import{u as K,a as Y,b as J,r as f,s as Q,j as e,H as V,m as $,c as F,B as m,I as M,T as o,d as k,M as X,N as Z,e as ee,F as ae,f as se,g as ne,S as ie,h,C as te,i as le,k as re,L as oe,l as ce,n as de,o as pe,p as me,q as ue,t as he,Q as r,v as _}from"./index-DlnMm5kh.js";const ge=()=>{const c=K(a=>a.userprofile),w=Y(),{handleImage:C}=he(),B=J(),I="https://res.cloudinary.com/dusxlxlvm/image/upload/v1718950087/battlefiesta/assets/icon/user_p5egd9.webp",E={name:"",username:"",email:"",phone:"",city:"",state:"",bio:"",publicemail:"",publicphone:"",profile:"",cover:"",sociallinks:[]},[n,j]=f.useState(E),[v,R]=f.useState(""),[d,O]=f.useState({plan:"N/A",planprice:"N/A",buydate:"N/A",expirydate:"N/A",expire_in:"N/A",status:"N/A",tournament:"N/A"});f.useEffect(()=>{c.userprofile&&U()},[c]);const P=Q("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),U=async()=>{if(!c.membership)return;let a=c.userprofile,s=c.membership;j({...n,name:a.name,username:a.username,email:a.email,phone:a.phone,city:a.city,state:a.state,bio:a.bio,publicemail:a.publicemail,publicphone:a.publicphone,sociallinks:a.sociallinks,profile:a.imgsrc,cover:a.coversrc}),c.membership.planid.plan_name&&O({plan:s.planid.plan_name,planprice:s.planid.price,tournament:s.planid.create_limit>500?"Unlimited":s.planid.create_limit,buydate:s.buy_date,expirydate:s.expire_date,expire_in:H(s.expire_date),status:s.isActive?"active":"expired"})},q=()=>{let a={name:"",link:""};j({...n,sociallinks:[...n.sociallinks,a]})},W=a=>{let s=n.sociallinks.filter((i,t)=>t!=a);j({...n,sociallinks:s})},S=(a,s)=>{const i=a.target.name,t=a.target.value,l=[...n.sociallinks];l[s]={...l[s],[i]:t},j({...n,sociallinks:l})},u=a=>{const s=a.target.name,i=a.target.value;j({...n,[s]:i})},[x,p]=f.useState(!1),y=async a=>{a.preventDefault(),p(!0);const s=r.loading("Please wait...");try{const i=localStorage.getItem("token"),t=await fetch("/api/updateprofile",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),l=await t.json();if(console.log(l),p(!1),!t.ok)return r.update(s,{render:l.message,type:"warning",isLoading:!1,autoClose:1600});w(_()),r.update(s,{render:l.message,type:"success",isLoading:!1,autoClose:1600})}catch(i){r.update(s,{render:i.message,type:"warn",isLoading:!1,autoClose:1600}),console.log(i),p(!1)}},L=async(a,s)=>{const i=a.target.files[0];let t,l;if(s=="profile"?(t=await C(230,i),l="/api/updateprofilepic"):(t=await C(600,i),l="/api/updatecoverpic"),t){const N=r.loading("Uploading Please wait...");p(!0);try{const b=localStorage.getItem("token"),D=new FormData;D.append(s==="profile"?"profilepic":"coverpic",t);const A=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${b}`},body:D}),T=await A.json();if(p(!1),A.ok){r.update(N,{render:T.message,type:"success",isLoading:!1,autoClose:1600}),w(_());return}r.update(N,{render:T.message,type:"warning",isLoading:!1,autoClose:1600})}catch(b){r.update(N,{render:b.message,type:"warning",isLoading:!1,autoClose:1600}),console.log(b),p(!1)}}},G=async()=>{try{p(!0);const a=r.loading("Please wait..."),s=localStorage.getItem("token"),i=await fetch("/api/passreset",{method:"Get",headers:{Authorization:`Bearer ${s}`}}),t=await i.json();if(p(!1),!i.ok)return r.update(a,{render:t.message,type:"warn",isLoading:!1,autoClose:2100});R(t.extramessage),r.update(a,{render:t.message,type:"success",isLoading:!1,autoClose:2100})}catch(a){r.update(id,{render:a.message,type:"warn",isLoading:!1,autoClose:2200}),p(!1),console.log(a)}},z=a=>{const s={day:"2-digit",month:"short",year:"numeric"};return new Date(a).toLocaleDateString("en-GB",s)};function H(a){const t=new Date(a)-new Date;return Math.floor(t/(1e3*60*60*24))+1}const g="bg-gradient-to-br from-white/70 to-white/20 backdrop-blur-[12px] rounded-xl px-4 py-3";return e.jsxs("div",{className:"profilepage",children:[e.jsxs(V,{children:[e.jsxs("title",{children:[n.name," | Profile"]}),e.jsx("link",{rel:"canonical",href:`${window.location.origin}/profile`}),e.jsx("meta",{name:"description",content:"Manage your BattleFiesta profile, update personal details, track tournament history, and customize settings for a better gaming experience."})]}),e.jsx($.div,{animate:{scale:[1,1.2,1.2,1],rotate:[0,90,90,0],borderRadius:["10%","20%","40%","10%"]},transition:{duration:8,ease:"easeInOut",repeat:1/0},className:`\r
    absolute rounded-full\r
    w-[300px] h-[300px]\r
    bg-gradient-to-tr from-pink-200 to-orange-600\r
    top-[45%] left-[15%]\r
    max-[600px]:w-[250px] max-[600px]:h-[250px]\r
  `}),e.jsx($.div,{animate:{scale:[1,1.1,1.1,1]},transition:{duration:4,repeat:1/0},className:`\r
    absolute rounded-full\r
    w-[300px] h-[300px]\r
    bg-gradient-to-tr from-pink-400 to-blue-700\r
    top-[5%] right-[10%]\r
    max-[600px]:top-[10%] max-[600px]:right-[5%]\r
  `}),e.jsxs("div",{className:"materials",children:[e.jsxs("div",{className:`profilepic  ${g}`,children:[e.jsx("h2",{children:"Profile Picture"}),e.jsxs("div",{className:"coverimg",children:[e.jsx("img",{src:F(n==null?void 0:n.cover,{format:"webp"})||I,loading:"lazy",alt:"cover picture"}),e.jsx("div",{className:"img",children:e.jsx("img",{src:F(n==null?void 0:n.profile,{format:"webp",width:150,height:150})||I,loading:"lazy",alt:"profile picture"})})]}),e.jsxs(m,{component:"label",sx:{mt:6},disabled:x,role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(M,{}),className:"splbtn",children:["Change Cover",e.jsx(P,{onChange:a=>L(a,"cover"),type:"file",accept:"image/*"})]}),e.jsxs(m,{component:"label",sx:{mt:1},disabled:x,role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(M,{}),className:"splbtn",children:["Change Profile",e.jsx(P,{onChange:a=>L(a,"profile"),type:"file",accept:"image/*"})]})]}),e.jsxs("div",{className:`profiledeatil  ${g}`,children:[e.jsx("h2",{children:"Profile"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"input",children:[e.jsx(o,{size:"small",onChange:u,name:"name",value:n.name||"",className:"half",label:"Display Name",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"username",value:n.username||"",className:"half",label:"UserName",variant:"outlined"}),e.jsx(o,{size:"small",contentEditable:!1,disabled:!0,name:"email",value:n.email||"",className:"half",label:"Email",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"phone",value:n.phone||"",type:"tel",inputProps:{minLength:10,maxLength:10},onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},className:"half",label:"Phone",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"city",value:n.city,className:"half",label:"City",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"state",value:n.state,className:"half",label:"State",variant:"outlined"}),e.jsx(o,{onChange:u,name:"bio",value:n.bio,multiline:!0,rows:2,className:"full textarea",label:"Bio/About",variant:"outlined"})]}),e.jsx(m,{disabled:x,variant:"contained",startIcon:e.jsx(k,{}),className:"splbtn",type:"submit",size:"small",children:"Save"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(X,{}),className:"splbtn",size:"small",sx:{marginLeft:1},onClick:()=>{var a;return B(`/channel/@${(a=c==null?void 0:c.userprofile)==null?void 0:a.username}`)},children:"Public Profile"})]})]}),e.jsxs("div",{className:`membership  ${g}`,children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{children:" Plan"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:[d.plan," Plan"]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Plan price"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:["₹ ",d.planprice,".00"]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Tournament"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{children:d.tournament})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Buy Date"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{children:z(d.buydate)})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Expiry Date"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:[z(d.expirydate)," "]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Expire In"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{style:{color:d.expire_in<6&&"red"},children:[d.expire_in," Days "]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Status"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{className:`status ${d.status}`,children:d.status})," "]}),e.jsxs(Z,{className:"navlink",to:"/subscription",children:["  ",e.jsx(m,{variant:"contained",className:"splbtn",startIcon:e.jsx(ee,{}),children:"Buy Membership"})]})]})]}),e.jsxs("div",{className:`passchange  ${g}`,children:[e.jsx("h2",{children:"Change Password"}),e.jsxs("div",{children:[e.jsx(o,{required:!0,name:"link",InputProps:{readOnly:!0},fullWidth:!0,size:"small",value:n.email,className:"half",label:"Email Address",variant:"outlined"}),v&&e.jsx("p",{style:{color:"green",fontSize:"14px"},children:v}),!v.length&&e.jsxs("p",{style:{fontSize:"14px"},children:["A verification email will be sent to ",e.jsx("b",{children:n.email}),"."]}),e.jsx(m,{disabled:x,onClick:G,title:"Send Password Reset Link",variant:"contained",className:"splbtn",startIcon:e.jsx(ae,{}),children:"Send Password Reset Link"})]})]}),e.jsxs("div",{className:`privacy  ${g}`,children:[e.jsx("h2",{children:"Privacy"}),e.jsxs("div",{className:"input",children:[e.jsx(o,{onChange:u,name:"publicemail",value:n.publicemail||"",className:"full",helperText:"This emaill will be visible on your profile page",label:"Public Email",variant:"outlined"}),e.jsx(o,{onChange:u,type:"tel",inputProps:{minLength:10,maxLength:10},onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},name:"publicphone",value:n.publicphone||"",className:"full",helperText:"This phone number will be visible on your profile page",label:"Public Phone",variant:"outlined"})]}),e.jsx(m,{disabled:x,variant:"contained",startIcon:e.jsx(k,{}),className:"splbtn",onClick:y,size:"small",children:"Save"})]}),e.jsxs("div",{className:`social  ${g}`,children:[e.jsx("h2",{children:"Social Links"}),e.jsxs("form",{onSubmit:y,children:[n.sociallinks&&n.sociallinks.map((a,s)=>e.jsxs("div",{className:"link",children:[e.jsx("span",{children:e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(ne,{children:"Name*"}),e.jsxs(ie,{labelId:"demo-simple-select-label",value:a.name,required:!0,label:"Name",name:"name",onChange:i=>S(i,s),children:[e.jsxs(h,{value:"facebook",children:[e.jsx(te,{}),"   Facebook"]}),e.jsxs(h,{value:"youtube",children:[e.jsx(le,{}),"   Youtube"]}),e.jsxs(h,{value:"instagram",children:[e.jsx(re,{}),"  Instagram"]}),e.jsxs(h,{value:"discord",children:[e.jsx(oe,{}),"  Discord"]}),e.jsxs(h,{value:"telegram",children:[e.jsx(ce,{}),"  Telegram"]}),e.jsxs(h,{value:"twitter",children:[e.jsx(de,{}),"  Twitter"]}),e.jsxs(h,{value:"website",children:[e.jsx(pe,{}),"  Website"]})]})]})}),e.jsx("span",{children:e.jsx(o,{required:!0,value:a.link,name:"link",fullWidth:!0,size:"small",onChange:i=>S(i,s),className:"half",label:"Url",variant:"outlined"})}),e.jsxs("span",{title:"Remove This",onClick:()=>W(s),children:[" ",e.jsx(me,{})," "]})]},s)),e.jsx("div",{children:e.jsx(m,{variant:"outlined",onClick:q,startIcon:e.jsx(ue,{}),children:"Add"})}),e.jsx(m,{disabled:x,variant:"contained",startIcon:e.jsx(k,{}),className:"splbtn",type:"submit",size:"small",children:"Save"})]})]})]})]})};export{ge as default};
