import{r as c,U as _,_ as V,V as se,W as g,X as z,j as e,s as J,Y as X,Z as Y,$ as oe,a0 as W,a1 as R,a2 as ne,a3 as re,a4 as T,a5 as le,a6 as ie,a7 as ce,Q as y,a8 as de,a9 as me,B as I,aa as M,ab as H,ac as O,f as ue,g as he,S as pe,h as xe,T as A,ad as fe,ae as ye,af as ge}from"./index-Cu7lg40h.js";import{d as be}from"./dayjs.min-C1uXXJzt.js";import{X as E,u as P,A as ve}from"./AllDbModal-CdbZdZkR.js";const je=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Ce=a=>{const{classes:o,inset:n,primary:l,secondary:s,dense:r}=a;return Y({root:["root",n&&"inset",r&&"dense",l&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},oe,o)},Se=J("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(a,o)=>{const{ownerState:n}=a;return[{[`& .${W.primary}`]:o.primary},{[`& .${W.secondary}`]:o.secondary},o.root,n.inset&&o.inset,n.primary&&n.secondary&&o.multiline,n.dense&&o.dense]}})(({ownerState:a})=>g({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},a.primary&&a.secondary&&{marginTop:6,marginBottom:6},a.inset&&{paddingLeft:56})),ke=c.forwardRef(function(o,n){const l=_({props:o,name:"MuiListItemText"}),{children:s,className:r,disableTypography:d=!1,inset:x=!1,primary:j,primaryTypographyProps:i,secondary:S,secondaryTypographyProps:N}=l,C=V(l,je),{dense:u}=c.useContext(se);let h=j??s,p=S;const f=g({},l,{disableTypography:d,inset:x,primary:!!h,secondary:!!p,dense:u}),b=Ce(f);return h!=null&&h.type!==z&&!d&&(h=e.jsx(z,g({variant:u?"body2":"body1",className:b.primary,component:i!=null&&i.variant?void 0:"span",display:"block"},i,{children:h}))),p!=null&&p.type!==z&&!d&&(p=e.jsx(z,g({variant:"body2",className:b.secondary,color:"text.secondary",display:"block"},N,{children:p}))),e.jsxs(Se,g({className:X(b.root,r),ownerState:f,ref:n},C,{children:[h,p]}))}),Ne=R(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ie=R(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),we=R(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ze(a){return re("MuiCheckbox",a)}const B=ne("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),$e=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],Te=a=>{const{classes:o,indeterminate:n,color:l,size:s}=a,r={root:["root",n&&"indeterminate",`color${T(l)}`,`size${T(s)}`]},d=Y(r,ze,o);return g({},o,d)},Me=J(le,{shouldForwardProp:a=>ie(a)||a==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(a,o)=>{const{ownerState:n}=a;return[o.root,n.indeterminate&&o.indeterminate,o[`size${T(n.size)}`],n.color!=="default"&&o[`color${T(n.color)}`]]}})(({theme:a,ownerState:o})=>g({color:(a.vars||a).palette.text.secondary},!o.disableRipple&&{"&:hover":{backgroundColor:a.vars?`rgba(${o.color==="default"?a.vars.palette.action.activeChannel:a.vars.palette[o.color].mainChannel} / ${a.vars.palette.action.hoverOpacity})`:ce(o.color==="default"?a.palette.action.active:a.palette[o.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${B.checked}, &.${B.indeterminate}`]:{color:(a.vars||a).palette[o.color].main},[`&.${B.disabled}`]:{color:(a.vars||a).palette.action.disabled}})),Ae=e.jsx(Ie,{}),Ee=e.jsx(Ne,{}),Pe=e.jsx(we,{}),Be=c.forwardRef(function(o,n){var l,s;const r=_({props:o,name:"MuiCheckbox"}),{checkedIcon:d=Ae,color:x="primary",icon:j=Ee,indeterminate:i=!1,indeterminateIcon:S=Pe,inputProps:N,size:C="medium",className:u}=r,h=V(r,$e),p=i?S:j,f=i?S:d,b=g({},r,{color:x,indeterminate:i,size:C}),k=Te(b);return e.jsx(Me,g({type:"checkbox",inputProps:g({"data-indeterminate":i},N),icon:c.cloneElement(p,{fontSize:(l=p.props.fontSize)!=null?l:C}),checkedIcon:c.cloneElement(f,{fontSize:(s=f.props.fontSize)!=null?s:C}),ownerState:b,ref:n,className:X(k.root,u)},h,{classes:k}))}),$="/api/backup-schedules",L=a=>a?a.trim().split(/\s+/).length!==5?{valid:!1,message:"Cron must have 5 fields (min hour day month week)"}:/^(\*|\*\/\d+|\d+|\d+\-\d+)(\s+(\*|\*\/\d+|\d+|\d+\-\d+)){4}$/.test(a)?{valid:!0,message:"Valid cron expression"}:{valid:!1,message:"Invalid cron syntax"}:{valid:!1,message:"Cron expression required"},U=a=>{const{valid:o,message:n}=L(a);if(!o)return n;const[l,s,,,r]=a.split(" ");if(l.startsWith("*/"))return`Runs every ${l.replace("*/","")} Minutes`;if(r==="*"){const x=Number(s),j=Number(l),i=x>=12?"PM":"AM";return`Runs every day at ${x%12||12}:${j.toString().padStart(2,"0")} ${i}`}return`Runs every ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][r]} at ${s}:${l}`},D={databases:[],cron:"* * * * *",timezone:"Asia/Kolkata",enabled:!0,emailNotification:{enabled:!1,email:""}},Fe=()=>{const[a,o]=c.useState([]),[n,l]=c.useState([]),[s,r]=c.useState(D),[d,x]=c.useState(null),[j,i]=c.useState(!1),[S,N]=c.useState(!1),[C,u]=c.useState(!1),[h,p]=c.useState(null),[f,b]=c.useState(null);c.useEffect(()=>{k()},[]);const k=async()=>{const t=localStorage.getItem("token");u(!0);try{const v=await(await fetch($,{headers:{Authorization:`Bearer ${t}`}})).json();o(v.schedules||[]),l(v.database||[])}catch{y.error("Failed to load schedules")}finally{u(!1)}},q=async()=>{const t=localStorage.getItem("token");u(!0);try{const v=await(await fetch("/api/getJobStatus",{headers:{Authorization:`Bearer ${t}`}})).json();console.log(v),b(v.jobs)}catch{y.error("Failed to load schedules")}finally{u(!1)}},G=async t=>{t.preventDefault();const{valid:m,message:v}=L(s.cron);if(!m){y.error(v);return}if(!s.databases.length){y.error("Select at least one database");return}if(s.emailNotification.enabled&&!s.emailNotification.email){y.error("Email address required");return}const te=localStorage.getItem("token"),F=y.loading("Saving...");u(!0);try{const w=await fetch(d?`${$}/${d}`:$,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te}`},body:JSON.stringify(s)}),ae=await w.json();if(!w.ok)throw new Error(ae.message);y.update(F,{render:"Saved successfully",type:"success",isLoading:!1,autoClose:1500}),r(D),x(null),i(!1),k()}catch(w){y.update(F,{render:w.message,type:"error",isLoading:!1})}finally{u(!1)}},K=async t=>{swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Schedule",icon:"warning",buttons:!0,dangerMode:!0}).then(async m=>{if(m){const v=localStorage.getItem("token");u(!0);try{await fetch(`${$}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}}),y.success("Deleted"),k()}catch{y.error("Delete failed")}finally{u(!1)}}})},Q=[{name:"S.no",selector:(t,m)=>m+1,width:"40px"},{name:"Db Name",selector:t=>t.databases.join(", ")},{name:"Cron",selector:t=>e.jsxs("span",{children:[e.jsx("p",{style:{letterSpacing:"4px"},children:t.cron}),e.jsx("p",{style:{fontSize:"13px",color:"GrayText"},children:U(t.cron)})]}),width:"200px"},{name:"Email",selector:t=>{var m;return(m=t.emailNotification)!=null&&m.enabled?t.emailNotification.email:"-"}},{name:"Status",selector:t=>t.enabled?"✅ Active":"❌ Inactive",width:"80px"},{name:"Action",cell:t=>e.jsxs("div",{className:"flex gap-2 lg:gap-1",children:[e.jsx("div",{onClick:()=>{r(t),x(t._id),i(!0)},className:"w-7 h-7 flex items-center justify-center rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 cursor-pointer transition",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("div",{onClick:()=>p(t.logs),className:"w-7 h-7 flex items-center justify-center rounded-md bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer transition",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("div",{onClick:()=>K(t._id),className:"w-7 h-7 flex items-center justify-center rounded-md bg-red-100 text-red-700 hover:bg-red-200 cursor-pointer transition",children:e.jsx(ge,{className:"w-4 h-4"})})]}),width:"120px",ignoreRowClick:!0}],Z=[{name:"S.no",selector:(t,m)=>m+1,width:"40px"},{name:"Started At",selector:t=>be(t.startedAt).format("DD/MM/YY hh:mm A")},{name:"Status",selector:t=>e.jsx("div",{className:t.status==="SUCCESS"?"px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700":t.status==="FAILED"?"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700":"px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700",children:t.status}),width:"90px"},{name:"Duration",selector:t=>t.durationMs/1e3+" Seconds",width:"120px"}],ee=[{name:"S.no",selector:(t,m)=>m+1,width:"40px"},{name:"Job Id",selector:t=>t.jobId}];return e.jsxs("div",{className:" min-h-screen p-1 bg-amber-50 backup",children:[e.jsxs("div",{className:"inner w-full",children:[e.jsxs("div",{className:"controler px-1 py-2 relative flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between ",children:[e.jsx("h2",{className:"text-lg font-semibold sm:text-xl",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:flex-nowrap sm:gap-[10px] ",children:[e.jsx(de,{loading:C,onClick:k,endIcon:e.jsx(me,{}),variant:"outlined",size:"small",children:"REFRESH"}),e.jsx(I,{size:"small",variant:"contained",onClick:()=>{r(D),x(null),i(!0)},children:"ADD Jobs"}),e.jsx(I,{size:"small",variant:"contained",onClick:()=>N(!0),children:"Dbs"}),e.jsx(I,{size:"small",variant:"contained",onClick:q,children:"Get stat"})]})]}),e.jsx(E,{columns:Q,data:a,pagination:!0,customStyles:P()})]}),e.jsx(M,{open:j,onClose:()=>"",children:e.jsxs("div",{className:"content w-100",children:[e.jsx("p",{className:"header",children:"Schedules"}),e.jsx("div",{className:"modalbody",children:e.jsxs("form",{id:"form",onSubmit:G,children:[d&&e.jsx(H,{control:e.jsx(O,{checked:s.enabled,onChange:t=>r({...s,enabled:t.target.checked})}),label:s.enabled?"Enabled":"Disabled"}),e.jsxs(ue,{fullWidth:!0,size:"small",children:[e.jsx(he,{children:"Databases"}),e.jsx(pe,{multiple:!0,value:s.databases,label:"Databases",renderValue:t=>t.join(", "),onChange:t=>r({...s,databases:t.target.value}),children:n.map(t=>e.jsxs(xe,{value:t.name,children:[e.jsx(Be,{checked:s.databases.includes(t.name)}),e.jsx(ke,{primary:t.name})]},t.name))})]}),e.jsx(A,{label:"Cron Expression (sec min hour day month week)",placeholder:"*/10 * * * * *",size:"small",fullWidth:!0,value:s.cron,error:!L(s.cron).valid,helperText:U(s.cron),onChange:t=>r({...s,cron:t.target.value}),InputProps:{sx:{letterSpacing:"2px",textAlign:"center",fontFamily:"monospace",fontWeight:500}}}),e.jsx(A,{label:"Timezone",size:"small",fullWidth:!0,disabled:!0,value:s.timezone}),e.jsx(H,{control:e.jsx(O,{checked:s.emailNotification.enabled,onChange:t=>r({...s,emailNotification:{...s.emailNotification,enabled:t.target.checked}})}),label:"Email Notification"}),s.emailNotification.enabled&&e.jsx(A,{type:"email",label:"Email Address",size:"small",fullWidth:!0,value:s.emailNotification.email,onChange:t=>r({...s,emailNotification:{...s.emailNotification,email:t.target.value}})})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{disabled:C,variant:"contained",size:"small",form:"form",type:"submit",children:"SAVE"}),e.jsx(I,{variant:"outlined",onClick:()=>i(!1),children:"Cancel"})]})]})}),e.jsx(M,{open:(h==null?void 0:h.length)>0,onClose:()=>p(null),children:e.jsxs("div",{className:"content w-120 ",children:[e.jsx("p",{className:"header ",children:"Schedules"}),e.jsx("div",{className:"modalbody ",children:e.jsx(E,{columns:Z,data:h,pagination:!0,customStyles:P(),highlightOnHover:!0})})]})}),e.jsx(M,{open:(f==null?void 0:f.length)>0,onClose:()=>b(null),children:e.jsxs("div",{className:"content w-100 h-300",children:[e.jsx("p",{className:"header",children:"Task History Stats"}),e.jsx("div",{className:"modalbody",children:e.jsx(E,{columns:ee,data:f,customStyles:P(),highlightOnHover:!0})})]})}),e.jsx(ve,{databaselist:n,dbmodal:S,setdbmodal:N})]})};export{Fe as default};
