import{r as c,U as V,_ as J,V as ae,W as b,X as $,j as e,s as X,Y,Z as q,$ as se,a0 as H,a1 as F,a2 as oe,a3 as ne,a4 as M,a5 as re,a6 as le,a7 as ie,Q as g,a8 as ce,a9 as de,B as I,aa as A,ab as O,ac as U,f as me,g as ue,S as he,h as pe,T as E,ad as xe,ae as fe,af as ye}from"./index-CCn-YaJ3.js";import{d as ge}from"./dayjs.min-dPHZ2t90.js";import{X as P,u as B,A as be}from"./AllDbModal-C87jFIYN.js";const je=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],ve=a=>{const{classes:o,inset:n,primary:l,secondary:s,dense:r}=a;return q({root:["root",n&&"inset",r&&"dense",l&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},se,o)},Ce=X("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(a,o)=>{const{ownerState:n}=a;return[{[`& .${H.primary}`]:o.primary},{[`& .${H.secondary}`]:o.secondary},o.root,n.inset&&o.inset,n.primary&&n.secondary&&o.multiline,n.dense&&o.dense]}})(({ownerState:a})=>b({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},a.primary&&a.secondary&&{marginTop:6,marginBottom:6},a.inset&&{paddingLeft:56})),Se=c.forwardRef(function(o,n){const l=V({props:o,name:"MuiListItemText"}),{children:s,className:r,disableTypography:d=!1,inset:x=!1,primary:v,primaryTypographyProps:i,secondary:S,secondaryTypographyProps:N}=l,C=J(l,je),{dense:u}=c.useContext(ae);let h=v??s,p=S;const f=b({},l,{disableTypography:d,inset:x,primary:!!h,secondary:!!p,dense:u}),j=ve(f);return h!=null&&h.type!==$&&!d&&(h=e.jsx($,b({variant:u?"body2":"body1",className:j.primary,component:i!=null&&i.variant?void 0:"span",display:"block"},i,{children:h}))),p!=null&&p.type!==$&&!d&&(p=e.jsx($,b({variant:"body2",className:j.secondary,color:"text.secondary",display:"block"},N,{children:p}))),e.jsxs(Ce,b({className:Y(j.root,r),ownerState:f,ref:n},C,{children:[h,p]}))}),ke=F(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ne=F(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Ie=F(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function we(a){return ne("MuiCheckbox",a)}const L=oe("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),ze=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],$e=a=>{const{classes:o,indeterminate:n,color:l,size:s}=a,r={root:["root",n&&"indeterminate",`color${M(l)}`,`size${M(s)}`]},d=q(r,we,o);return b({},o,d)},Te=X(re,{shouldForwardProp:a=>le(a)||a==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(a,o)=>{const{ownerState:n}=a;return[o.root,n.indeterminate&&o.indeterminate,o[`size${M(n.size)}`],n.color!=="default"&&o[`color${M(n.color)}`]]}})(({theme:a,ownerState:o})=>b({color:(a.vars||a).palette.text.secondary},!o.disableRipple&&{"&:hover":{backgroundColor:a.vars?`rgba(${o.color==="default"?a.vars.palette.action.activeChannel:a.vars.palette[o.color].mainChannel} / ${a.vars.palette.action.hoverOpacity})`:ie(o.color==="default"?a.palette.action.active:a.palette[o.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${L.checked}, &.${L.indeterminate}`]:{color:(a.vars||a).palette[o.color].main},[`&.${L.disabled}`]:{color:(a.vars||a).palette.action.disabled}})),Me=e.jsx(Ne,{}),Ae=e.jsx(ke,{}),Ee=e.jsx(Ie,{}),Pe=c.forwardRef(function(o,n){var l,s;const r=V({props:o,name:"MuiCheckbox"}),{checkedIcon:d=Me,color:x="primary",icon:v=Ae,indeterminate:i=!1,indeterminateIcon:S=Ee,inputProps:N,size:C="medium",className:u}=r,h=J(r,ze),p=i?S:v,f=i?S:d,j=b({},r,{color:x,indeterminate:i,size:C}),k=$e(j);return e.jsx(Te,b({type:"checkbox",inputProps:b({"data-indeterminate":i},N),icon:c.cloneElement(p,{fontSize:(l=p.props.fontSize)!=null?l:C}),checkedIcon:c.cloneElement(f,{fontSize:(s=f.props.fontSize)!=null?s:C}),ownerState:j,ref:n,className:Y(k.root,u)},h,{classes:k}))}),T="/api/backup-schedules",D=a=>a?a.trim().split(/\s+/).length!==5?{valid:!1,message:"Cron must have 5 fields (min hour day month week)"}:/^(\*|\*\/\d+|\d+|\d+\-\d+)(\s+(\*|\*\/\d+|\d+|\d+\-\d+)){4}$/.test(a)?{valid:!0,message:"Valid cron expression"}:{valid:!1,message:"Invalid cron syntax"}:{valid:!1,message:"Cron expression required"},_=a=>{const{valid:o,message:n}=D(a);if(!o)return n;const[l,s,,,r]=a.split(" ");if(l.startsWith("*/"))return`Runs every ${l.replace("*/","")} Minutes`;if(r==="*"){const x=Number(s),v=Number(l),i=x>=12?"PM":"AM";return`Runs every day at ${x%12||12}:${v.toString().padStart(2,"0")} ${i}`}return`Runs every ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][r]} at ${s}:${l}`},R={databases:[],cron:"* * * * *",timezone:"Asia/Kolkata",enabled:!0,emailNotification:{enabled:!1,email:""}},De=()=>{const[a,o]=c.useState([]),[n,l]=c.useState([]),[s,r]=c.useState(R),[d,x]=c.useState(null),[v,i]=c.useState(!1),[S,N]=c.useState(!1),[C,u]=c.useState(!1),[h,p]=c.useState(null),[f,j]=c.useState(null);c.useEffect(()=>{k()},[]);const k=async()=>{const t=localStorage.getItem("token");u(!0);try{const y=await(await fetch(T,{headers:{Authorization:`Bearer ${t}`}})).json();console.log(y),o(y.schedules||[]),l(y.database||[])}catch{g.error("Failed to load schedules")}finally{u(!1)}},G=async()=>{const t=localStorage.getItem("token");u(!0);try{const y=await(await fetch("/api/getJobStatus",{headers:{Authorization:`Bearer ${t}`}})).json();console.log(y),j(y.jobs)}catch{g.error("Failed to load schedules")}finally{u(!1)}},w=async()=>{const{valid:t,message:m}=D(s.cron);if(!t){g.error(m);return}if(!s.databases.length){g.error("Select at least one database");return}if(s.emailNotification.enabled&&!s.emailNotification.email){g.error("Email address required");return}const y=localStorage.getItem("token"),W=g.loading("Saving...");u(!0);try{const z=await fetch(d?`${T}/${d}`:T,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(s)}),te=await z.json();if(!z.ok)throw new Error(te.message);g.update(W,{render:"Saved successfully",type:"success",isLoading:!1,autoClose:1500}),r(R),x(null),i(!1),k()}catch(z){g.update(W,{render:z.message,type:"error",isLoading:!1})}finally{u(!1)}},K=async t=>{swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Schedule",icon:"warning",buttons:!0,dangerMode:!0}).then(async m=>{if(m){const y=localStorage.getItem("token");u(!0);try{await fetch(`${T}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}}),g.success("Deleted"),k()}catch{g.error("Delete failed")}finally{u(!1)}}})},Q=[{name:"S.no",selector:(t,m)=>m+1,width:"40px"},{name:"Db Name",selector:t=>t.databases.join(", ")},{name:"Cron",selector:t=>e.jsxs("span",{children:[e.jsx("p",{style:{letterSpacing:"4px"},children:t.cron}),e.jsx("p",{style:{fontSize:"13px",color:"GrayText"},children:_(t.cron)})]}),width:"200px"},{name:"Email",selector:t=>{var m;return(m=t.emailNotification)!=null&&m.enabled?t.emailNotification.email:"-"}},{name:"Status",selector:t=>t.enabled?"✅ Active":"❌ Inactive",width:"80px"},{name:"Action",cell:t=>e.jsxs("div",{className:"flex gap-2 lg:gap-1",children:[e.jsx("div",{onClick:()=>{r(t),x(t._id),i(!0)},className:"w-7 h-7 flex items-center justify-center rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 cursor-pointer transition",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("div",{onClick:()=>p(t.logs),className:"w-7 h-7 flex items-center justify-center rounded-md bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer transition",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("div",{onClick:()=>K(t._id),className:"w-7 h-7 flex items-center justify-center rounded-md bg-red-100 text-red-700 hover:bg-red-200 cursor-pointer transition",children:e.jsx(ye,{className:"w-4 h-4"})})]}),width:"120px",ignoreRowClick:!0}],Z=[{name:"S.no",selector:(t,m)=>m+1,width:"40px"},{name:"Started At",selector:t=>ge(t.startedAt).format("DD/MM/YY hh:mm A")},{name:"Status",selector:t=>e.jsx("div",{className:t.status==="SUCCESS"?"px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700":t.status==="FAILED"?"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700":"px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700",children:t.status}),width:"90px"},{name:"Duration",selector:t=>t.durationMs/1e3+" Seconds",width:"120px"}],ee=[{name:"S.no",selector:(t,m)=>m+1,width:"40px"},{name:"Job Id",selector:t=>t.jobId}];return e.jsxs("div",{className:" min-h-screen p-1 bg-amber-50 backup",children:[e.jsxs("div",{className:"inner w-full",children:[e.jsxs("div",{className:"controler px-1 py-2 relative flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between ",children:[e.jsx("h2",{className:"text-lg font-semibold sm:text-xl",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:flex-nowrap sm:gap-[10px] ",children:[e.jsx(ce,{loading:C,onClick:k,endIcon:e.jsx(de,{}),variant:"outlined",size:"small",children:"REFRESH"}),e.jsx(I,{size:"small",variant:"contained",onClick:()=>{r(R),x(null),i(!0)},children:"ADD Jobs"}),e.jsx(I,{size:"small",variant:"contained",onClick:()=>N(!0),children:"Dbs"}),e.jsx(I,{size:"small",variant:"contained",onClick:G,children:"Get stat"})]})]}),e.jsx(P,{columns:Q,data:a,pagination:!0,customStyles:B()})]}),e.jsx(A,{open:v,onClose:()=>"",children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:w,children:[e.jsx("h2",{children:"Schedules"}),e.jsxs("span",{className:"modalcontent",children:[d&&e.jsx(O,{control:e.jsx(U,{checked:s.enabled,onChange:t=>r({...s,enabled:t.target.checked})}),label:s.enabled?"Enabled":"Disabled"}),e.jsxs(me,{fullWidth:!0,size:"small",children:[e.jsx(ue,{children:"Databases"}),e.jsx(he,{multiple:!0,value:s.databases,label:"Databases",renderValue:t=>t.join(", "),onChange:t=>r({...s,databases:t.target.value}),children:n.map(t=>e.jsxs(pe,{value:t.name,children:[e.jsx(Pe,{checked:s.databases.includes(t.name)}),e.jsx(Se,{primary:t.name})]},t.name))})]}),e.jsx(E,{label:"Cron Expression (sec min hour day month week)",placeholder:"*/10 * * * * *",size:"small",fullWidth:!0,value:s.cron,error:!D(s.cron).valid,helperText:_(s.cron),onChange:t=>r({...s,cron:t.target.value}),InputProps:{sx:{letterSpacing:"2px",textAlign:"center",fontFamily:"monospace",fontWeight:500}}}),e.jsx(E,{label:"Timezone",size:"small",fullWidth:!0,disabled:!0,value:s.timezone}),e.jsx(O,{control:e.jsx(U,{checked:s.emailNotification.enabled,onChange:t=>r({...s,emailNotification:{...s.emailNotification,enabled:t.target.checked}})}),label:"Email Notification"}),s.emailNotification.enabled&&e.jsx(E,{type:"email",label:"Email Address",size:"small",fullWidth:!0,value:s.emailNotification.email,onChange:t=>r({...s,emailNotification:{...s.emailNotification,email:t.target.value}})}),e.jsxs("div",{style:{width:"100%"},children:[e.jsx(I,{disabled:C,variant:"contained",size:"small",onClick:w,children:"SAVE"}),e.jsx(I,{variant:"outlined",onClick:()=>i(!1),children:"Cancel"})]})]})]})})}),e.jsx(A,{open:(h==null?void 0:h.length)>0,onClose:()=>p(null),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:w,children:[e.jsx("h2",{children:"Schedules"}),e.jsx("span",{className:"modalcontent",children:e.jsx(P,{columns:Z,data:h,pagination:!0,customStyles:B(),highlightOnHover:!0})})]})})}),e.jsx(A,{open:(f==null?void 0:f.length)>0,onClose:()=>j(null),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:w,children:[e.jsx("h2",{children:"Task History Stats"}),e.jsx("span",{className:"modalcontent",children:e.jsx(P,{columns:ee,data:f,customStyles:B(),highlightOnHover:!0})})]})})}),e.jsx(be,{databaselist:n,dbmodal:S,setdbmodal:N})]})};export{De as default};
