import{s as V,U as W,_ as g,r as c,V as J,W as X,X as te,Y as T,j as e,Z as Y,$ as q,a0 as se,a1 as F,a2 as oe,a3 as ne,a4 as re,a5 as ie,a6 as w,a7 as le,Q as b,a8 as ce,a9 as de,B as $,aa as A,ab as H,ac as U,f as me,g as ue,S as he,h as pe,T as E,ad as xe,ae as ye,af as fe}from"./index-lCoMiMSn.js";import{d as be}from"./dayjs.min-zu_nvXPg.js";import{X as P,u as L,A as ge}from"./AllDbModal-8G-6b8I1.js";const je=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],ve=t=>{const{classes:o,inset:n,primary:i,secondary:s,dense:r}=t;return q({root:["root",n&&"inset",r&&"dense",i&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},se,o)},Ce=V("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:n}=t;return[{[`& .${W.primary}`]:o.primary},{[`& .${W.secondary}`]:o.secondary},o.root,n.inset&&o.inset,n.primary&&n.secondary&&o.multiline,n.dense&&o.dense]}})(({ownerState:t})=>g({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},t.primary&&t.secondary&&{marginTop:6,marginBottom:6},t.inset&&{paddingLeft:56})),Se=c.forwardRef(function(o,n){const i=J({props:o,name:"MuiListItemText"}),{children:s,className:r,disableTypography:d=!1,inset:x=!1,primary:v,primaryTypographyProps:l,secondary:S,secondaryTypographyProps:I}=i,C=X(i,je),{dense:u}=c.useContext(te);let h=v??s,p=S;const y=g({},i,{disableTypography:d,inset:x,primary:!!h,secondary:!!p,dense:u}),j=ve(y);return h!=null&&h.type!==T&&!d&&(h=e.jsx(T,g({variant:u?"body2":"body1",className:j.primary,component:l!=null&&l.variant?void 0:"span",display:"block"},l,{children:h}))),p!=null&&p.type!==T&&!d&&(p=e.jsx(T,g({variant:"body2",className:j.secondary,color:"text.secondary",display:"block"},I,{children:p}))),e.jsxs(Ce,g({className:Y(j.root,r),ownerState:y,ref:n},C,{children:[h,p]}))}),ke=Se,Ie=F(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),$e=F(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),ze=F(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function Ne(t){return ne("MuiCheckbox",t)}const Te=oe("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),B=Te,Me=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],we=t=>{const{classes:o,indeterminate:n,color:i,size:s}=t,r={root:["root",n&&"indeterminate",`color${w(i)}`,`size${w(s)}`]},d=q(r,Ne,o);return g({},o,d)},Ae=V(re,{shouldForwardProp:t=>ie(t)||t==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:n}=t;return[o.root,n.indeterminate&&o.indeterminate,o[`size${w(n.size)}`],n.color!=="default"&&o[`color${w(n.color)}`]]}})(({theme:t,ownerState:o})=>g({color:(t.vars||t).palette.text.secondary},!o.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${o.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:le(o.color==="default"?t.palette.action.active:t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${B.checked}, &.${B.indeterminate}`]:{color:(t.vars||t).palette[o.color].main},[`&.${B.disabled}`]:{color:(t.vars||t).palette.action.disabled}})),Ee=e.jsx($e,{}),Pe=e.jsx(Ie,{}),Le=e.jsx(ze,{}),Be=c.forwardRef(function(o,n){var i,s;const r=J({props:o,name:"MuiCheckbox"}),{checkedIcon:d=Ee,color:x="primary",icon:v=Pe,indeterminate:l=!1,indeterminateIcon:S=Le,inputProps:I,size:C="medium",className:u}=r,h=X(r,Me),p=l?S:v,y=l?S:d,j=g({},r,{color:x,indeterminate:l,size:C}),k=we(j);return e.jsx(Ae,g({type:"checkbox",inputProps:g({"data-indeterminate":l},I),icon:c.cloneElement(p,{fontSize:(i=p.props.fontSize)!=null?i:C}),checkedIcon:c.cloneElement(y,{fontSize:(s=y.props.fontSize)!=null?s:C}),ownerState:j,ref:n,className:Y(k.root,u)},h,{classes:k}))}),Re=Be,M="/api/backup-schedules",D=t=>t?t.trim().split(/\s+/).length!==5?{valid:!1,message:"Cron must have 5 fields (min hour day month week)"}:/^(\*|\*\/\d+|\d+|\d+\-\d+)(\s+(\*|\*\/\d+|\d+|\d+\-\d+)){4}$/.test(t)?{valid:!0,message:"Valid cron expression"}:{valid:!1,message:"Invalid cron syntax"}:{valid:!1,message:"Cron expression required"},_=t=>{const{valid:o,message:n}=D(t);if(!o)return n;const[i,s,,,r]=t.split(" ");if(i.startsWith("*/"))return`Runs every ${i.replace("*/","")} Minutes`;if(r==="*"){const x=Number(s),v=Number(i),l=x>=12?"PM":"AM";return`Runs every day at ${x%12||12}:${v.toString().padStart(2,"0")} ${l}`}return`Runs every ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][r]} at ${s}:${i}`},R={databases:[],cron:"* * * * *",timezone:"Asia/Kolkata",enabled:!0,emailNotification:{enabled:!1,email:""}},We=()=>{const[t,o]=c.useState([]),[n,i]=c.useState([]),[s,r]=c.useState(R),[d,x]=c.useState(null),[v,l]=c.useState(!1),[S,I]=c.useState(!1),[C,u]=c.useState(!1),[h,p]=c.useState(null),[y,j]=c.useState(null);c.useEffect(()=>{k()},[]);const k=async()=>{const a=localStorage.getItem("token");u(!0);try{const f=await(await fetch(M,{headers:{Authorization:`Bearer ${a}`}})).json();console.log(f),o(f.schedules||[]),i(f.database||[])}catch{b.error("Failed to load schedules")}finally{u(!1)}},G=async()=>{const a=localStorage.getItem("token");u(!0);try{const f=await(await fetch("/api/getJobStatus",{headers:{Authorization:`Bearer ${a}`}})).json();console.log(f),j(f.jobs)}catch{b.error("Failed to load schedules")}finally{u(!1)}},z=async()=>{const{valid:a,message:m}=D(s.cron);if(!a){b.error(m);return}if(!s.databases.length){b.error("Select at least one database");return}if(s.emailNotification.enabled&&!s.emailNotification.email){b.error("Email address required");return}const f=localStorage.getItem("token"),O=b.loading("Saving...");u(!0);try{const N=await fetch(d?`${M}/${d}`:M,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify(s)}),ae=await N.json();if(!N.ok)throw new Error(ae.message);b.update(O,{render:"Saved successfully",type:"success",isLoading:!1,autoClose:1500}),r(R),x(null),l(!1),k()}catch(N){b.update(O,{render:N.message,type:"error",isLoading:!1})}finally{u(!1)}},K=async a=>{swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Schedule",icon:"warning",buttons:!0,dangerMode:!0}).then(async m=>{if(m){const f=localStorage.getItem("token");u(!0);try{await fetch(`${M}/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`}}),b.success("Deleted"),k()}catch{b.error("Delete failed")}finally{u(!1)}}})},Q=[{name:"S.no",selector:(a,m)=>m+1,width:"40px"},{name:"Db Name",selector:a=>a.databases.join(", ")},{name:"Cron",selector:a=>e.jsxs("span",{children:[e.jsx("p",{style:{letterSpacing:"4px"},children:a.cron}),e.jsx("p",{style:{fontSize:"13px",color:"GrayText"},children:_(a.cron)})]}),width:"200px"},{name:"Email",selector:a=>{var m;return(m=a.emailNotification)!=null&&m.enabled?a.emailNotification.email:"-"}},{name:"Status",selector:a=>a.enabled?"✅ Active":"❌ Inactive",width:"80px"},{name:"Action",cell:a=>e.jsxs("span",{style:{display:"flex",gap:"8px"},children:[e.jsx(xe,{onClick:()=>{r(a),x(a._id),l(!0)}}),e.jsx(ye,{onClick:()=>{p(a.logs)}}),e.jsx(fe,{onClick:()=>K(a._id)})]}),width:"120px",ignoreRowClick:!0,allowOverflow:!0,button:!0}],Z=[{name:"S.no",selector:(a,m)=>m+1,width:"40px"},{name:"Started At",selector:a=>be(a.startedAt).format("DD/MM/YY hh:mm A")},{name:"Status",selector:a=>e.jsxs("div",{className:a.status=="SUCCESS"?"status success":a.status=="FAILED"?"status failed":"status running",children:[" ",a.status]}),width:"80px"},{name:"Duration",selector:a=>a.durationMs/1e3+" Seconds",width:"120px"}],ee=[{name:"S.no",selector:(a,m)=>m+1,width:"40px"},{name:"Job Id",selector:a=>a.jobId}];return e.jsxs("div",{className:"admindashboard backup",children:[e.jsxs("div",{className:"inner",children:[e.jsxs("div",{className:"controler",children:[e.jsx("h2",{children:"Admin Dashboard"}),e.jsxs("div",{children:[e.jsx(ce,{loading:C,onClick:k,endIcon:e.jsx(de,{}),variant:"outlined",size:"small",children:"REFRESH"}),e.jsx($,{size:"small",variant:"contained",onClick:()=>{r(R),x(null),l(!0)},children:"ADD Jobs"}),e.jsx($,{size:"small",variant:"contained",onClick:()=>I(!0),children:"Dbs"}),e.jsx($,{size:"small",variant:"contained",onClick:G,children:"Get stat"})]})]}),e.jsx("div",{id:"cronjobhistory",children:e.jsx(P,{columns:Q,data:t,pagination:!0,customStyles:L()})})]}),e.jsx(A,{open:v,onClose:()=>"",children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:z,children:[e.jsx("h2",{children:"Schedules"}),e.jsxs("span",{className:"modalcontent",children:[d&&e.jsx(H,{control:e.jsx(U,{checked:s.enabled,onChange:a=>r({...s,enabled:a.target.checked})}),label:s.enabled?"Enabled":"Disabled"}),e.jsxs(me,{fullWidth:!0,size:"small",children:[e.jsx(ue,{children:"Databases"}),e.jsx(he,{multiple:!0,value:s.databases,label:"Databases",renderValue:a=>a.join(", "),onChange:a=>r({...s,databases:a.target.value}),children:n.map(a=>e.jsxs(pe,{value:a.name,children:[e.jsx(Re,{checked:s.databases.includes(a.name)}),e.jsx(ke,{primary:a.name})]},a.name))})]}),e.jsx(E,{label:"Cron Expression (sec min hour day month week)",placeholder:"*/10 * * * * *",size:"small",fullWidth:!0,value:s.cron,error:!D(s.cron).valid,helperText:_(s.cron),onChange:a=>r({...s,cron:a.target.value}),InputProps:{sx:{letterSpacing:"2px",textAlign:"center",fontFamily:"monospace",fontWeight:500}}}),e.jsx(E,{label:"Timezone",size:"small",fullWidth:!0,disabled:!0,value:s.timezone}),e.jsx(H,{control:e.jsx(U,{checked:s.emailNotification.enabled,onChange:a=>r({...s,emailNotification:{...s.emailNotification,enabled:a.target.checked}})}),label:"Email Notification"}),s.emailNotification.enabled&&e.jsx(E,{type:"email",label:"Email Address",size:"small",fullWidth:!0,value:s.emailNotification.email,onChange:a=>r({...s,emailNotification:{...s.emailNotification,email:a.target.value}})}),e.jsxs("div",{style:{width:"100%"},children:[e.jsx($,{disabled:C,variant:"contained",size:"small",onClick:z,children:"SAVE"}),e.jsx($,{variant:"outlined",onClick:()=>l(!1),children:"Cancel"})]})]})]})})}),e.jsx(A,{open:(h==null?void 0:h.length)>0,onClose:()=>p(null),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:z,children:[e.jsx("h2",{children:"Schedules"}),e.jsx("span",{className:"modalcontent",children:e.jsx(P,{columns:Z,data:h,pagination:!0,customStyles:L(),highlightOnHover:!0})})]})})}),e.jsx(A,{open:(y==null?void 0:y.length)>0,onClose:()=>j(null),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:z,children:[e.jsx("h2",{children:"Task History Stats"}),e.jsx("span",{className:"modalcontent",children:e.jsx(P,{columns:ee,data:y,customStyles:L(),highlightOnHover:!0})})]})})}),e.jsx(ge,{databaselist:n,dbmodal:S,setdbmodal:I})]})};export{We as default};
