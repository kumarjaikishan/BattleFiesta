import{s as V,U as B,_ as b,r as d,V as H,W as X,X as Q,Y as z,j as e,Z as Y,$ as q,a0 as Z,a1 as L,a2 as ee,a3 as ae,a4 as se,a5 as te,a6 as M,a7 as oe,Q as g,a8 as ne,a9 as re,B as N,aa as D,ab as F,ac as W,f as ie,g as le,S as ce,h as de,T as E,ad as me,ae as ue,af as he}from"./index-YXKoBC_c.js";import{d as pe}from"./dayjs.min-SSKtTJJJ.js";import{X as O,u as U,A as xe}from"./AllDbModal-pcvPQI-R.js";const ye=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],fe=s=>{const{classes:o,inset:n,primary:i,secondary:t,dense:r}=s;return q({root:["root",n&&"inset",r&&"dense",i&&t&&"multiline"],primary:["primary"],secondary:["secondary"]},Z,o)},be=V("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:n}=s;return[{[`& .${B.primary}`]:o.primary},{[`& .${B.secondary}`]:o.secondary},o.root,n.inset&&o.inset,n.primary&&n.secondary&&o.multiline,n.dense&&o.dense]}})(({ownerState:s})=>b({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},s.primary&&s.secondary&&{marginTop:6,marginBottom:6},s.inset&&{paddingLeft:56})),ge=d.forwardRef(function(o,n){const i=H({props:o,name:"MuiListItemText"}),{children:t,className:r,disableTypography:c=!1,inset:x=!1,primary:v,primaryTypographyProps:l,secondary:C,secondaryTypographyProps:S}=i,j=X(i,ye),{dense:h}=d.useContext(Q);let m=v??t,u=C;const y=b({},i,{disableTypography:c,inset:x,primary:!!m,secondary:!!u,dense:h}),f=fe(y);return m!=null&&m.type!==z&&!c&&(m=e.jsx(z,b({variant:h?"body2":"body1",className:f.primary,component:l!=null&&l.variant?void 0:"span",display:"block"},l,{children:m}))),u!=null&&u.type!==z&&!c&&(u=e.jsx(z,b({variant:"body2",className:f.secondary,color:"text.secondary",display:"block"},S,{children:u}))),e.jsxs(be,b({className:Y(f.root,r),ownerState:y,ref:n},j,{children:[m,u]}))}),ve=ge,je=L(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ce=L(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),ke=L(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function Se(s){return ae("MuiCheckbox",s)}const Ie=ee("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),w=Ie,$e=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],ze=s=>{const{classes:o,indeterminate:n,color:i,size:t}=s,r={root:["root",n&&"indeterminate",`color${M(i)}`,`size${M(t)}`]},c=q(r,Se,o);return b({},o,c)},Ne=V(se,{shouldForwardProp:s=>te(s)||s==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:n}=s;return[o.root,n.indeterminate&&o.indeterminate,o[`size${M(n.size)}`],n.color!=="default"&&o[`color${M(n.color)}`]]}})(({theme:s,ownerState:o})=>b({color:(s.vars||s).palette.text.secondary},!o.disableRipple&&{"&:hover":{backgroundColor:s.vars?`rgba(${o.color==="default"?s.vars.palette.action.activeChannel:s.vars.palette[o.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:oe(o.color==="default"?s.palette.action.active:s.palette[o.color].main,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${w.checked}, &.${w.indeterminate}`]:{color:(s.vars||s).palette[o.color].main},[`&.${w.disabled}`]:{color:(s.vars||s).palette.action.disabled}})),Te=e.jsx(Ce,{}),Me=e.jsx(je,{}),Ee=e.jsx(ke,{}),we=d.forwardRef(function(o,n){var i,t;const r=H({props:o,name:"MuiCheckbox"}),{checkedIcon:c=Te,color:x="primary",icon:v=Me,indeterminate:l=!1,indeterminateIcon:C=Ee,inputProps:S,size:j="medium",className:h}=r,m=X(r,$e),u=l?C:v,y=l?C:c,f=b({},r,{color:x,indeterminate:l,size:j}),I=ze(f);return e.jsx(Ne,b({type:"checkbox",inputProps:b({"data-indeterminate":l},S),icon:d.cloneElement(u,{fontSize:(i=u.props.fontSize)!=null?i:j}),checkedIcon:d.cloneElement(y,{fontSize:(t=y.props.fontSize)!=null?t:j}),ownerState:f,ref:n,className:Y(I.root,h)},m,{classes:I}))}),Ae=we,T="/api/backup-schedules",P=s=>s?s.trim().split(/\s+/).length!==5?{valid:!1,message:"Cron must have 5 fields (min hour day month week)"}:/^(\*|\*\/\d+|\d+|\d+\-\d+)(\s+(\*|\*\/\d+|\d+|\d+\-\d+)){4}$/.test(s)?{valid:!0,message:"Valid cron expression"}:{valid:!1,message:"Invalid cron syntax"}:{valid:!1,message:"Cron expression required"},_=s=>{const{valid:o,message:n}=P(s);if(!o)return n;const[i,t,,,r]=s.split(" ");if(i.startsWith("*/"))return`Runs every ${i.replace("*/","")} Minutes`;if(r==="*"){const x=Number(t),v=Number(i),l=x>=12?"PM":"AM";return`Runs every day at ${x%12||12}:${v.toString().padStart(2,"0")} ${l}`}return`Runs every ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][r]} at ${t}:${i}`},A={databases:[],cron:"* * * * *",timezone:"Asia/Kolkata",enabled:!0,emailNotification:{enabled:!1,email:""}},Be=()=>{const[s,o]=d.useState([]),[n,i]=d.useState([]),[t,r]=d.useState(A),[c,x]=d.useState(null),[v,l]=d.useState(!1),[C,S]=d.useState(!1),[j,h]=d.useState(!1),[m,u]=d.useState(null);d.useEffect(()=>{y()},[]);const y=async()=>{const a=localStorage.getItem("token");h(!0);try{const k=await(await fetch(T,{headers:{Authorization:`Bearer ${a}`}})).json();console.log(k),o(k.schedules||[]),i(k.database||[])}catch{g.error("Failed to load schedules")}finally{h(!1)}},f=async()=>{const{valid:a,message:p}=P(t.cron);if(!a){g.error(p);return}if(!t.databases.length){g.error("Select at least one database");return}if(t.emailNotification.enabled&&!t.emailNotification.email){g.error("Email address required");return}const k=localStorage.getItem("token"),R=g.loading("Saving...");h(!0);try{const $=await fetch(c?`${T}/${c}`:T,{method:c?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify(t)}),K=await $.json();if(!$.ok)throw new Error(K.message);g.update(R,{render:"Saved successfully",type:"success",isLoading:!1,autoClose:1500}),r(A),x(null),l(!1),y()}catch($){g.update(R,{render:$.message,type:"error",isLoading:!1})}finally{h(!1)}},I=async a=>{swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Schedule",icon:"warning",buttons:!0,dangerMode:!0}).then(async p=>{if(p){const k=localStorage.getItem("token");h(!0);try{await fetch(`${T}/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${k}`}}),g.success("Deleted"),y()}catch{g.error("Delete failed")}finally{h(!1)}}})},J=[{name:"S.no",selector:(a,p)=>p+1,width:"40px"},{name:"Db Name",selector:a=>a.databases.join(", ")},{name:"Cron",selector:a=>e.jsxs("span",{children:[e.jsx("p",{style:{letterSpacing:"4px"},children:a.cron}),e.jsx("p",{style:{fontSize:"13px",color:"GrayText"},children:_(a.cron)})]}),width:"200px"},{name:"Email",selector:a=>{var p;return(p=a.emailNotification)!=null&&p.enabled?a.emailNotification.email:"-"}},{name:"Status",selector:a=>a.enabled?"✅ Active":"❌ Inactive",width:"80px"},{name:"Action",cell:a=>e.jsxs("span",{style:{display:"flex",gap:"8px"},children:[e.jsx(me,{onClick:()=>{r(a),x(a._id),l(!0)}}),e.jsx(ue,{onClick:()=>{u(a.logs)}}),e.jsx(he,{onClick:()=>I(a._id)})]}),width:"120px",ignoreRowClick:!0,allowOverflow:!0,button:!0}],G=[{name:"S.no",selector:(a,p)=>p+1,width:"40px"},{name:"Started At",selector:a=>pe(a.startedAt).format("DD/MM/YY hh:mm A")},{name:"Status",selector:a=>e.jsxs("div",{className:a.status=="SUCCESS"?"status success":a.status=="FAILED"?"status failed":"status running",children:[" ",a.status]}),width:"80px"},{name:"Duration",selector:a=>a.durationMs/1e3+" Seconds",width:"120px"}];return e.jsxs("div",{className:"admindashboard backup",children:[e.jsxs("div",{className:"inner",children:[e.jsxs("div",{className:"controler",children:[e.jsx("h2",{children:"Admin Dashboard"}),e.jsxs("div",{children:[e.jsx(ne,{loading:j,onClick:y,endIcon:e.jsx(re,{}),variant:"outlined",size:"small",children:"REFRESH"}),e.jsx(N,{size:"small",variant:"contained",onClick:()=>{r(A),x(null),l(!0)},children:"ADD Jobs"}),e.jsx(N,{size:"small",variant:"contained",onClick:()=>S(!0),children:"Dbs"})]})]}),e.jsx("div",{id:"cronjobhistory",children:e.jsx(O,{columns:J,data:s,pagination:!0,customStyles:U()})})]}),e.jsx(D,{open:v,onClose:()=>"",children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:f,children:[e.jsx("h2",{children:"Schedules"}),e.jsxs("span",{className:"modalcontent",children:[c&&e.jsx(F,{control:e.jsx(W,{checked:t.enabled,onChange:a=>r({...t,enabled:a.target.checked})}),label:t.enabled?"Enabled":"Disabled"}),e.jsxs(ie,{fullWidth:!0,size:"small",children:[e.jsx(le,{children:"Databases"}),e.jsx(ce,{multiple:!0,value:t.databases,label:"Databases",renderValue:a=>a.join(", "),onChange:a=>r({...t,databases:a.target.value}),children:n.map(a=>e.jsxs(de,{value:a.name,children:[e.jsx(Ae,{checked:t.databases.includes(a.name)}),e.jsx(ve,{primary:a.name})]},a.name))})]}),e.jsx(E,{label:"Cron Expression (sec min hour day month week)",placeholder:"*/10 * * * * *",size:"small",fullWidth:!0,value:t.cron,error:!P(t.cron).valid,helperText:_(t.cron),onChange:a=>r({...t,cron:a.target.value}),InputProps:{sx:{letterSpacing:"2px",textAlign:"center",fontFamily:"monospace",fontWeight:500}}}),e.jsx(E,{label:"Timezone",size:"small",fullWidth:!0,disabled:!0,value:t.timezone}),e.jsx(F,{control:e.jsx(W,{checked:t.emailNotification.enabled,onChange:a=>r({...t,emailNotification:{...t.emailNotification,enabled:a.target.checked}})}),label:"Email Notification"}),t.emailNotification.enabled&&e.jsx(E,{type:"email",label:"Email Address",size:"small",fullWidth:!0,value:t.emailNotification.email,onChange:a=>r({...t,emailNotification:{...t.emailNotification,email:a.target.value}})}),e.jsxs("div",{style:{width:"100%"},children:[e.jsx(N,{disabled:j,variant:"contained",size:"small",onClick:f,children:"SAVE"}),e.jsx(N,{variant:"outlined",onClick:()=>l(!1),children:"Cancel"})]})]})]})})}),e.jsx(D,{open:(m==null?void 0:m.length)>0,onClose:()=>u(null),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:f,children:[e.jsx("h2",{children:"Schedules"}),e.jsx("span",{className:"modalcontent",children:e.jsx(O,{columns:G,data:m,pagination:!0,customStyles:U(),highlightOnHover:!0})})]})})}),e.jsx(xe,{databaselist:n,dbmodal:C,setdbmodal:S})]})};export{Be as default};
