import{a2 as _,j as a,a4 as H,a3 as J,r as f,V as X,_ as G,X as b,s as B,Z as V,$ as Y,aq as K,u as L,a as Q,b as W,a9 as Z,aa as ee,ar as F,Q as r,ab as ae,T as D,B as M,f as E,g as T,S as $,h as R,ah as se,as as te,aj as oe,at as le,ak as ne}from"./index-DlnMm5kh.js";import{R as ie}from"./index-BAhxvl4e.js";import{X as re,u as ce}from"./AllDbModal-CO6KSjgR.js";import{C as z}from"./Modal-DIcId2O3.js";const de=_(a.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function me(s){return H("MuiAvatar",s)}J("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const ue=["alt","children","className","component","imgProps","sizes","src","srcSet","variant"],pe=s=>{const{classes:o,variant:n,colorDefault:c}=s;return Y({root:["root",n,c&&"colorDefault"],img:["img"],fallback:["fallback"]},me,o)},he=B("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:n}=s;return[o.root,o[n.variant],n.colorDefault&&o.colorDefault]}})(({theme:s})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:s.typography.fontFamily,fontSize:s.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(s.vars||s).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:b({color:(s.vars||s).palette.background.default},s.vars?{backgroundColor:s.vars.palette.Avatar.defaultBg}:b({backgroundColor:s.palette.grey[400]},s.applyStyles("dark",{backgroundColor:s.palette.grey[600]})))}]})),fe=B("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(s,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),ge=B(de,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(s,o)=>o.fallback})({width:"75%",height:"75%"});function xe({crossOrigin:s,referrerPolicy:o,src:n,srcSet:c}){const[u,l]=f.useState(!1);return f.useEffect(()=>{if(!n&&!c)return;l(!1);let p=!0;const i=new Image;return i.onload=()=>{p&&l("loaded")},i.onerror=()=>{p&&l("error")},i.crossOrigin=s,i.referrerPolicy=o,i.src=n,c&&(i.srcset=c),()=>{p=!1}},[s,o,n,c]),u}const ve=f.forwardRef(function(o,n){const c=X({props:o,name:"MuiAvatar"}),{alt:u,children:l,className:p,component:i="div",imgProps:h,sizes:j,src:C,srcSet:S,variant:P="circular"}=c,g=G(c,ue);let x=null;const v=xe(b({},h,{src:C,srcSet:S})),N=C||S,I=N&&v!=="error",y=b({},c,{colorDefault:!I,component:i,variant:P}),w=pe(y);return I?x=a.jsx(fe,b({alt:u,srcSet:S,src:C,sizes:j,ownerState:y,className:w.img},h)):l!=null&&l!==""&&typeof l!="boolean"?x=l:N&&u?x=u[0]:x=a.jsx(ge,{ownerState:y,className:w.fallback}),a.jsx(he,b({as:i,ownerState:y,className:V(w.root,p),ref:n},g,{children:x}))});function je(s){return K({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M17.187 19.181L24 4.755 0 12.386l9.196 1.963.043 4.896 2.759-2.617-2.147-2.076 7.336 4.63z"},child:[]}]})(s)}const we=()=>{const s=L(e=>e.admin),o=L(e=>e.admin),n=Q(),c=W(),u={id:"",name:"",phone:"",isverified:"",isadmin:""},[l,p]=f.useState(u),i={email:"",message:""},[h,j]=f.useState(i);f.useEffect(()=>{},[]);const C=e=>{const t={day:"2-digit",month:"short",year:"2-digit"};return new Date(e).toLocaleDateString("en-GB",t).replace(/(\d{2} \w{3}) (\d{2})/,"$1, $2")},S=async e=>{if(ne({title:"Are you sure?",icon:"warning",buttons:!0,dangerMode:!0}).then(async t=>{if(t){const d=r.loading("Please wait...");try{const m=localStorage.getItem("token"),k=await fetch("/api/deleteuser",{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({userid:e})}),U=await k.json();if(k.ok)n(F()),r.update(d,{render:U.message,type:"success",isLoading:!1,autoClose:2100});else return r.update(d,{render:U.message,type:"warn",isLoading:!1,autoClose:2100})}catch(m){r.update(d,{render:m.message,type:"warn",isLoading:!1,autoClose:5200}),console.log(m)}}}),!e)return r.warn("UserId cannot be blank")},[P,g]=f.useState(!1),[x,v]=f.useState(!1),N=async e=>{e.preventDefault();try{const t=localStorage.getItem("token"),d=await fetch("/api/editUser",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),m=await d.json();g(!1),d.status==200?(n(F()),p(u),r.success(m.message,{autoClose:1300})):r.warn(m.message,{autoClose:1500})}catch(t){r.error(t.message,{autoClose:1900}),console.log(t),g(!1)}},I=async e=>{e.preventDefault();const t=h.message.replace(/\n/g,"<br />");try{const d=localStorage.getItem("token"),m=await fetch("/api/emailsend",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({email:h.email,reply:t})}),k=await m.json();v(!1),m.status==200?(j(i),r.success(k.message,{autoClose:1300})):r.warn(k.message,{autoClose:1500})}catch(d){console.log(d),v(!1),r.error(d.message,{autoClose:1900})}},y=e=>{p({id:e._id,name:e.name,phone:e.phone,isverified:e.isverified,isadmin:e.isadmin}),g(!0)},w=e=>{j({email:e.email,message:""}),v(!0)},A=(e,t)=>{p({...l,[t]:e.target.value})},q=(e,t)=>{j({...h,[t]:e.target.value})},O=[{name:"S.no",selector:(e,t)=>t+1,width:"50px"},{name:"Name",cell:e=>{var t;return a.jsxs(te,{onClick:()=>c(`/channel/@${e.username}`),sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer","&:hover span":{color:"primary.main"}},children:[a.jsx(ve,{src:e.imgsrc,alt:e.name,sx:{width:32,height:32},children:!e.imgsrc&&((t=e.name)==null?void 0:t[0])}),a.jsx("span",{children:e.name})]})}},{name:"Mobile",selector:e=>e.phone},{name:"Email",selector:e=>e.email},{name:"Date",selector:e=>C(e.createdAt),width:"80px"},{name:"Member Stat",selector:e=>{var t;return(t=e==null?void 0:e.membership)!=null&&t.isActive?"✅ Active":"❌ Expired"},width:"100px"},{name:"Action",cell:e=>a.jsxs("div",{className:"flex gap-2 lg:gap-1",children:[a.jsx(oe,{className:"editicon ico",title:"Edit",onClick:()=>y(e)}),a.jsx(le,{className:"printicon ico",title:"Mail",onClick:()=>w(e)}),a.jsx(ie,{className:"deleteicon ico",title:"Delete",onClick:()=>S(e._id)})]}),width:"120px",ignoreRowClick:!0}];return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"adminusers p-1",children:[a.jsxs("div",{className:"controler flex flex-col items-center gap-2 py-[5px] sm:flex-row sm:justify-between",children:[a.jsx("h2",{className:"text-center text-xl font-semibold sm:text-left",children:"Users"}),a.jsx(Z,{loading:o.loading,onClick:async()=>{try{await n(F()).unwrap(),r.success("Refreshed!",{autoClose:900})}catch{r.error("Failed to refresh!")}},loadingPosition:"end",endIcon:a.jsx(ee,{}),variant:"outlined",type:"submit",size:"small",children:"REFRESH"})]}),a.jsx(re,{columns:O,data:s==null?void 0:s.users,pagination:!0,highlightOnHover:!0,customStyles:ce()}),a.jsx(ae,{open:x,onClose:()=>v(!1),children:a.jsxs("div",{className:"content w-100 mail",children:[a.jsx("p",{className:"header",children:"User Detail"}),a.jsx("div",{className:"modalbody",children:a.jsxs("form",{id:"form",onSubmit:I,children:[a.jsx(D,{required:!0,value:h.email,sx:{width:"98%"},label:"Email Id",disabled:!0,size:"small"}),a.jsx(D,{required:!0,value:h.message,onChange:e=>q(e,"message"),sx:{width:"98%"},multiline:!0,rows:8,label:"Message",size:"small"})]})}),a.jsxs("div",{className:"modalfooter",children:[a.jsx(M,{startIcon:a.jsx(je,{}),form:"form",type:"submit",variant:"contained",children:" Send"}),a.jsx(M,{onClick:()=>{v(!1),j(i)},variant:"outlined",children:" cancel"})]})]})}),a.jsxs(z,{open:P,backdrop:3,onClose:()=>g(!1),width:420,animation:!0,children:[a.jsx(z.Header,{children:a.jsx("p",{className:"header",children:"User Detail"})}),a.jsx(z.Body,{children:a.jsxs("form",{id:"form",onSubmit:N,children:[a.jsx(D,{required:!0,value:l.name,onChange:e=>A(e,"name"),sx:{width:"98%"},label:"Name",size:"small"}),a.jsx(D,{type:"tel",required:!0,value:l.phone,onChange:e=>A(e,"phone"),sx:{width:"98%"},label:"Mobile",onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},size:"small"}),a.jsxs(E,{sx:{width:"98%"},size:"small",children:[a.jsx(T,{id:"demo-simple-select-label",children:"Verify"}),a.jsxs($,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.isverified,label:"status",onChange:e=>A(e,"isverified"),children:[a.jsx(R,{value:!0,children:"Yes"}),a.jsx(R,{value:!1,children:"No"})]})]}),a.jsxs(E,{sx:{width:"98%"},size:"small",children:[a.jsx(T,{id:"demo-simple-select-label",children:"Admin"}),a.jsxs($,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.isadmin,label:"status",onChange:e=>A(e,"isadmin"),children:[a.jsx(R,{value:!0,children:"Yes"}),a.jsx(R,{value:!1,children:"No"})]})]})]})}),a.jsxs(z.Footer,{children:[a.jsx(M,{startIcon:a.jsx(se,{}),form:"form",type:"submit",variant:"contained",children:" Update"}),a.jsx(M,{onClick:()=>{g(!1),p(u)},variant:"outlined",children:" cancel"})]})]})]})})};export{we as default};
