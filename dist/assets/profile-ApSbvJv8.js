import{f as K,u as Y,a as J,r as f,g as Q,j as e,H as V,m as $,i as T,e as m,k as F,T as o,l as w,n as X,N as Z,o as ee,p as ae,q as se,t as ne,S as ie,v as le,w as te,x as re,Q as r,y as _,z as oe,A as ce,L as de,C as pe,D as me,E as ue}from"./index-BUI111fs.js";import"./dayjs.min-BhyCWFyO.js";import{u as he}from"./imageresizer-D4I-KFLq.js";import{C as xe}from"./index-CAzYEoS3.js";const ve=()=>{const c=K(a=>a.userprofile),N=Y(),{handleImage:k}=he(),M=J(),C="https://res.cloudinary.com/dusxlxlvm/image/upload/v1718950087/battlefiesta/assets/icon/user_p5egd9.webp",E={name:"",username:"",email:"",phone:"",city:"",state:"",bio:"",publicemail:"",publicphone:"",profile:"",cover:"",sociallinks:[]},[n,g]=f.useState(E),[j,O]=f.useState(""),[d,B]=f.useState({plan:"N/A",planprice:"N/A",buydate:"N/A",expirydate:"N/A",expire_in:"N/A",status:"N/A",tournament:"N/A"});f.useEffect(()=>{c.userprofile&&R()},[c]);const I=Q("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),R=async()=>{if(!c.membership)return;let a=c.userprofile,s=c.membership;g({...n,name:a.name,username:a.username,email:a.email,phone:a.phone,city:a.city,state:a.state,bio:a.bio,publicemail:a.publicemail,publicphone:a.publicphone,sociallinks:a.sociallinks,profile:a.imgsrc,cover:a.coversrc}),c.membership.planid.plan_name&&B({plan:s.planid.plan_name,planprice:s.planid.price,tournament:s.planid.create_limit>500?"Unlimited":s.planid.create_limit,buydate:s.buy_date,expirydate:s.expire_date,expire_in:G(s.expire_date),status:s.isActive?"active":"expired"})},U=()=>{let a={name:"",link:""};g({...n,sociallinks:[...n.sociallinks,a]})},q=a=>{let s=n.sociallinks.filter((i,l)=>l!=a);g({...n,sociallinks:s})},S=(a,s)=>{const i=a.target.name,l=a.target.value,t=[...n.sociallinks];t[s]={...t[s],[i]:l},g({...n,sociallinks:t})},u=a=>{const s=a.target.name,i=a.target.value;g({...n,[s]:i})},[h,p]=f.useState(!1),v=async a=>{a.preventDefault(),p(!0);const s=r.loading("Please wait...");try{const i=localStorage.getItem("token"),l=await fetch("/api/updateprofile",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await l.json();if(console.log(t),p(!1),!l.ok)return r.update(s,{render:t.message,type:"warning",isLoading:!1,autoClose:1600});N(_()),r.update(s,{render:t.message,type:"success",isLoading:!1,autoClose:1600})}catch(i){r.update(s,{render:i.message,type:"warning",isLoading:!1,autoClose:1600}),console.log(i),p(!1)}},P=async(a,s)=>{const i=a.target.files[0];let l,t;if(s=="profile"?(l=await k(230,i),t="/api/updateprofilepic"):(l=await k(600,i),t="/api/updatecoverpic"),l){const y=r.loading("Uploading Please wait...");p(!0);try{const b=localStorage.getItem("token"),z=new FormData;z.append(s==="profile"?"profilepic":"coverpic",l);const D=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${b}`},body:z}),A=await D.json();if(p(!1),D.ok){r.update(y,{render:A.message,type:"success",isLoading:!1,autoClose:1600}),N(_());return}r.update(y,{render:A.message,type:"warning",isLoading:!1,autoClose:1600})}catch(b){r.update(y,{render:b.message,type:"warning",isLoading:!1,autoClose:1600}),console.log(b),p(!1)}}},W=async()=>{try{p(!0);const a=r.loading("Please wait..."),s=localStorage.getItem("token"),i=await fetch("/api/passreset",{method:"Get",headers:{Authorization:`Bearer ${s}`}}),l=await i.json();if(p(!1),!i.ok)return r.update(a,{render:l.message,type:"warning",isLoading:!1,autoClose:2100});O(l.extramessage),r.update(a,{render:l.message,type:"success",isLoading:!1,autoClose:2100})}catch(a){r.update(id,{render:a.message,type:"warning",isLoading:!1,autoClose:2200}),p(!1),console.log(a)}},L=a=>{const s={day:"2-digit",month:"short",year:"numeric"};return new Date(a).toLocaleDateString("en-GB",s)};function G(a){const l=new Date(a)-new Date;return Math.floor(l/(1e3*60*60*24))+1}const x="bg-gradient-to-br from-white/70 to-white/20 backdrop-blur-[12px] rounded-xl px-4 py-3",H=[{value:"facebook",label:"Facebook",icon:e.jsx(xe,{})},{value:"youtube",label:"Youtube",icon:e.jsx(oe,{})},{value:"instagram",label:"Instagram",icon:e.jsx(ce,{})},{value:"discord",label:"Discord",icon:e.jsx(de,{})},{value:"telegram",label:"Telegram",icon:e.jsx(pe,{})},{value:"twitter",label:"Twitter",icon:e.jsx(me,{})},{value:"website",label:"Website",icon:e.jsx(ue,{})}];return e.jsxs("div",{className:"profilepage",children:[e.jsxs(V,{children:[e.jsxs("title",{children:[n.name," | Profile"]}),e.jsx("link",{rel:"canonical",href:`${window.location.origin}/profile`}),e.jsx("meta",{name:"description",content:"Manage your BattleFiesta profile, update personal details, track tournament history, and customize settings for a better gaming experience."})]}),e.jsx($.div,{animate:{scale:[1,1.2,1.2,1],rotate:[0,90,90,0],borderRadius:["10%","20%","40%","10%"]},transition:{duration:8,ease:"easeInOut",repeat:1/0},className:`\r
    absolute rounded-full\r
    w-[300px] h-[300px]\r
    bg-gradient-to-tr from-pink-200 to-orange-600\r
    top-[45%] left-[15%]\r
    max-[600px]:w-[250px] max-[600px]:h-[250px]\r
  `}),e.jsx($.div,{animate:{scale:[1,1.1,1.1,1]},transition:{duration:4,repeat:1/0},className:` absolute rounded-full\r
    w-[300px] h-[300px]\r
    bg-gradient-to-tr from-pink-400 to-blue-700\r
    top-[5%] right-[10%]\r
    max-[600px]:top-[10%] max-[600px]:right-[5%]\r
  `}),e.jsxs("div",{className:"materials",children:[e.jsxs("div",{className:`profilepic  ${x}`,children:[e.jsx("h2",{children:"Profile Picture"}),e.jsxs("div",{className:"coverimg",children:[e.jsx("img",{src:T(n==null?void 0:n.cover,{format:"webp"})||C,loading:"lazy",alt:"cover picture"}),e.jsx("div",{className:"img",children:e.jsx("img",{src:T(n==null?void 0:n.profile,{format:"webp",width:150,height:150})||C,loading:"lazy",alt:"profile picture"})})]}),e.jsxs(m,{component:"label",sx:{mt:6},disabled:h,role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(F,{}),className:"splbtn",children:["Change Cover",e.jsx(I,{onChange:a=>P(a,"cover"),type:"file",accept:"image/*"})]}),e.jsxs(m,{component:"label",sx:{mt:1},disabled:h,role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(F,{}),className:"splbtn",children:["Change Profile",e.jsx(I,{onChange:a=>P(a,"profile"),type:"file",accept:"image/*"})]})]}),e.jsxs("div",{className:`profiledeatil  ${x}`,children:[e.jsx("h2",{children:"Profile"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"input",children:[e.jsx(o,{size:"small",onChange:u,name:"name",value:n.name||"",className:"half",label:"Display Name",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"username",value:n.username||"",className:"half",label:"UserName",variant:"outlined"}),e.jsx(o,{size:"small",contentEditable:!1,disabled:!0,name:"email",value:n.email||"",className:"half",label:"Email",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"phone",value:n.phone||"",type:"tel",inputProps:{minLength:10,maxLength:10},onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},className:"half",label:"Phone",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"city",value:n.city,className:"half",label:"City",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"state",value:n.state,className:"half",label:"State",variant:"outlined"}),e.jsx(o,{onChange:u,name:"bio",value:n.bio,multiline:!0,rows:2,className:"full textarea",label:"Bio/About",variant:"outlined"})]}),e.jsx(m,{disabled:h,variant:"contained",startIcon:e.jsx(w,{}),className:"splbtn",type:"submit",size:"small",children:"Save"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(X,{}),className:"splbtn",size:"small",sx:{marginLeft:1},onClick:()=>{var a;return M(`/channel/@${(a=c==null?void 0:c.userprofile)==null?void 0:a.username}`)},children:"Public Profile"})]})]}),e.jsxs("div",{className:`membership  ${x}`,children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{children:" Plan"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:[d.plan," Plan"]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Plan price"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:["â‚¹ ",d.planprice,".00"]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Tournament"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{children:d.tournament})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Buy Date"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{children:L(d.buydate)})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Expiry Date"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:[L(d.expirydate)," "]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Expire In"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{style:{color:d.expire_in<6&&"red"},children:[d.expire_in," Days "]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Status"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{className:`status ${d.status}`,children:d.status})," "]}),e.jsxs(Z,{className:"navlink",to:"/subscription",children:["  ",e.jsx(m,{variant:"contained",className:"splbtn",startIcon:e.jsx(ee,{}),children:"Buy Membership"})]})]})]}),e.jsxs("div",{className:`passchange  ${x}`,children:[e.jsx("h2",{children:"Change Password"}),e.jsxs("div",{children:[e.jsx(o,{required:!0,name:"link",InputProps:{readOnly:!0},fullWidth:!0,size:"small",value:n.email,className:"half",label:"Email Address",variant:"outlined"}),j&&e.jsx("p",{style:{color:"green",fontSize:"14px"},children:j}),!j.length&&e.jsxs("p",{style:{fontSize:"14px"},children:["A verification email will be sent to ",e.jsx("b",{children:n.email}),"."]}),e.jsx(m,{disabled:h,onClick:W,title:"Send Password Reset Link",variant:"contained",className:"splbtn",startIcon:e.jsx(ae,{}),children:"Send Password Reset Link"})]})]}),e.jsxs("div",{className:`privacy  ${x}`,children:[e.jsx("h2",{children:"Privacy"}),e.jsxs("div",{className:"input",children:[e.jsx(o,{onChange:u,name:"publicemail",value:n.publicemail||"",className:"full",helperText:"This emaill will be visible on your profile page",label:"Public Email",variant:"outlined"}),e.jsx(o,{onChange:u,type:"tel",inputProps:{minLength:10,maxLength:10},onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},name:"publicphone",value:n.publicphone||"",className:"full",helperText:"This phone number will be visible on your profile page",label:"Public Phone",variant:"outlined"})]}),e.jsx(m,{disabled:h,variant:"contained",startIcon:e.jsx(w,{}),className:"splbtn",onClick:v,size:"small",children:"Save"})]}),e.jsxs("div",{className:`min-h-[340px] col-span-8 md:col-span-5 ${x}`,children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Social Links"}),e.jsxs("form",{onSubmit:v,children:[n.sociallinks&&n.sociallinks.map((a,s)=>e.jsxs("div",{className:`flex flex-wrap md:flex-nowrap items-center justify-between gap-3 md:gap-2\r
                                            h-fit p-3 md:p-1  md:h-[55px] px-[2px] my-2  rounded-md\r
                                               lg:border-none border border-gray-400`,children:[e.jsx("span",{className:"inline-block w-full  md:w-[28%]",children:e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(ne,{id:`platform-label-${s}`,children:"Name*"}),e.jsx(ie,{labelId:`platform-label-${s}`,value:a.name,required:!0,label:"Name",name:"name",onChange:i=>S(i,s),children:H.map(({value:i,label:l,icon:t})=>e.jsx(le,{value:i,children:e.jsxs("span",{className:"flex items-center gap-2",children:[t,l]})},i))})]})}),e.jsx("span",{className:"inline-block w-[85%] md:w-[65%]",children:e.jsx(o,{required:!0,value:a.link,name:"link",fullWidth:!0,size:"small",onChange:i=>S(i,s),label:"Url",variant:"outlined"})}),e.jsx("span",{title:"Remove This",onClick:()=>q(s),className:`inline-flex items-center justify-center\r
                       w-[25px] h-[25px]\r
                       cursor-pointer\r
                       text-red-500\r
                       hover:bg-red-100\r
                       rounded-full\r
                       transition`,children:e.jsx(te,{})})]},s)),e.jsx("div",{className:"my-3",children:e.jsx(m,{variant:"outlined",onClick:U,startIcon:e.jsx(re,{}),children:"Add"})}),e.jsx(m,{disabled:h,variant:"contained",startIcon:e.jsx(w,{}),type:"submit",size:"small",className:"mt-2",children:"Save"})]})]})]})]})};export{ve as default};
