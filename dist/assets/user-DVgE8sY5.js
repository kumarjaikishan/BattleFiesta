import{V as H,j as a,X as J,W as X,r as v,Y,Z as T,s as B,$ as G,a1 as V,a4 as _,ar as K,u as $,a as Q,b as W,B as k,ab as Z,as as U,Q as c,ac as ee,T as A,f as L,g as O,S as q,h as D,ai as ae,at as se,ak as te,au as oe,al as le}from"./index-C7219dIT.js";import{R as re}from"./index-DldTkNIy.js";import{X as ne,u as ie}from"./AllDbModal-DzJbMc3S.js";import{C as M}from"./Modal-OIPrqVVr.js";const ce=H(a.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}));function de(s){return J("MuiAvatar",s)}X("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const me=s=>{const{classes:d,variant:o,colorDefault:m}=s;return V({root:["root",o,m&&"colorDefault"],img:["img"],fallback:["fallback"]},de,d)},ue=B("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(s,d)=>{const{ownerState:o}=s;return[d.root,d[o.variant],o.colorDefault&&d.colorDefault]}})(_(({theme:s})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:s.typography.fontFamily,fontSize:s.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(s.vars||s).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:{color:(s.vars||s).palette.background.default,...s.vars?{backgroundColor:s.vars.palette.Avatar.defaultBg}:{backgroundColor:s.palette.grey[400],...s.applyStyles("dark",{backgroundColor:s.palette.grey[600]})}}}]}))),pe=B("img",{name:"MuiAvatar",slot:"Img"})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),he=B(ce,{name:"MuiAvatar",slot:"Fallback"})({width:"75%",height:"75%"});function fe({crossOrigin:s,referrerPolicy:d,src:o,srcSet:m}){const[p,l]=v.useState(!1);return v.useEffect(()=>{if(!o&&!m)return;l(!1);let h=!0;const n=new Image;return n.onload=()=>{h&&l("loaded")},n.onerror=()=>{h&&l("error")},n.crossOrigin=s,n.referrerPolicy=d,n.src=o,m&&(n.srcset=m),()=>{h=!1}},[s,d,o,m]),p}const ge=v.forwardRef(function(d,o){const m=Y({props:d,name:"MuiAvatar"}),{alt:p,children:l,className:h,component:n="div",slots:f={},slotProps:u={},imgProps:I,sizes:P,src:S,srcSet:g,variant:F="circular",...y}=m;let j=null;const x={...m,component:n,variant:F},R=fe({...I,...typeof u.img=="function"?u.img(x):u.img,src:S,srcSet:g}),N=S||g,b=N&&R!=="error";x.colorDefault=!b,delete x.ownerState;const w=me(x),[z,e]=T("root",{ref:o,className:G(w.root,h),elementType:ue,externalForwardedProps:{slots:f,slotProps:u,component:n,...y},ownerState:x}),[t,r]=T("img",{className:w.img,elementType:pe,externalForwardedProps:{slots:f,slotProps:{img:{...I,...u.img}}},additionalProps:{alt:p,src:S,srcSet:g,sizes:P},ownerState:x}),[i,C]=T("fallback",{className:w.fallback,elementType:he,externalForwardedProps:{slots:f,slotProps:u},shouldForwardComponentProp:!0,ownerState:x});return b?j=a.jsx(t,{...r}):l||l===0?j=l:N&&p?j=p[0]:j=a.jsx(i,{...C}),a.jsx(z,{...e,children:j})});function xe(s){return K({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M17.187 19.181L24 4.755 0 12.386l9.196 1.963.043 4.896 2.759-2.617-2.147-2.076 7.336 4.63z"},child:[]}]})(s)}const Ce=()=>{const s=$(e=>e.admin),d=$(e=>e.admin),o=Q(),m=W(),p={id:"",name:"",phone:"",isverified:"",isadmin:""},[l,h]=v.useState(p),n={email:"",message:""},[f,u]=v.useState(n);v.useEffect(()=>{},[]);const I=e=>{const t={day:"2-digit",month:"short",year:"2-digit"};return new Date(e).toLocaleDateString("en-GB",t).replace(/(\d{2} \w{3}) (\d{2})/,"$1, $2")},P=async e=>{if(le({title:"Are you sure?",icon:"warning",buttons:!0,dangerMode:!0}).then(async t=>{if(t){const r=c.loading("Please wait...");try{const i=localStorage.getItem("token"),C=await fetch("/api/deleteuser",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({userid:e})}),E=await C.json();if(C.ok)o(U()),c.update(r,{render:E.message,type:"success",isLoading:!1,autoClose:2100});else return c.update(r,{render:E.message,type:"warn",isLoading:!1,autoClose:2100})}catch(i){c.update(r,{render:i.message,type:"warn",isLoading:!1,autoClose:5200}),console.log(i)}}}),!e)return c.warn("UserId cannot be blank")},[S,g]=v.useState(!1),[F,y]=v.useState(!1),j=async e=>{e.preventDefault();try{const t=localStorage.getItem("token"),r=await fetch("/api/editUser",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),i=await r.json();g(!1),r.status==200?(o(U()),h(p),c.success(i.message,{autoClose:1300})):c.warn(i.message,{autoClose:1500})}catch(t){c.error(t.message,{autoClose:1900}),console.log(t),g(!1)}},x=async e=>{e.preventDefault();const t=f.message.replace(/\n/g,"<br />");try{const r=localStorage.getItem("token"),i=await fetch("/api/emailsend",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({email:f.email,reply:t})}),C=await i.json();y(!1),i.status==200?(u(n),c.success(C.message,{autoClose:1300})):c.warn(C.message,{autoClose:1500})}catch(r){console.log(r),y(!1),c.error(r.message,{autoClose:1900})}},R=e=>{h({id:e._id,name:e.name,phone:e.phone,isverified:e.isverified,isadmin:e.isadmin}),g(!0)},N=e=>{u({email:e.email,message:""}),y(!0)},b=(e,t)=>{h({...l,[t]:e.target.value})},w=(e,t)=>{u({...f,[t]:e.target.value})},z=[{name:"S.no",selector:(e,t)=>t+1,width:"50px"},{name:"Name",cell:e=>{var t;return a.jsxs(se,{onClick:()=>m(`/channel/@${e.username}`),sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer","&:hover span":{color:"primary.main"}},children:[a.jsx(ge,{src:e.imgsrc,alt:e.name,sx:{width:32,height:32},children:!e.imgsrc&&((t=e.name)==null?void 0:t[0])}),a.jsx("span",{children:e.name})]})}},{name:"Mobile",selector:e=>e.phone},{name:"Email",selector:e=>e.email},{name:"Date",selector:e=>I(e.createdAt),width:"80px"},{name:"Member Stat",selector:e=>{var t;return(t=e==null?void 0:e.membership)!=null&&t.isActive?"✅ Active":"❌ Expired"},width:"100px"},{name:"Action",cell:e=>a.jsxs("div",{className:"flex gap-2 lg:gap-1",children:[a.jsx(te,{className:"editicon ico",title:"Edit",onClick:()=>R(e)}),a.jsx(oe,{className:"printicon ico",title:"Mail",onClick:()=>N(e)}),a.jsx(re,{className:"deleteicon ico",title:"Delete",onClick:()=>P(e._id)})]}),width:"120px",ignoreRowClick:!0}];return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"adminusers p-1",children:[a.jsxs("div",{className:"controler flex flex-col items-center gap-2 py-[5px] sm:flex-row sm:justify-between",children:[a.jsx("h2",{className:"text-center text-xl font-semibold sm:text-left",children:"Users"}),a.jsx(k,{loading:d.loading,onClick:async()=>{try{await o(U()).unwrap(),c.success("Refreshed!",{autoClose:900})}catch{c.error("Failed to refresh!")}},loadingPosition:"end",endIcon:a.jsx(Z,{}),variant:"outlined",type:"submit",size:"small",children:"REFRESH"})]}),a.jsx(ne,{columns:z,data:s==null?void 0:s.users,pagination:!0,highlightOnHover:!0,customStyles:ie()}),a.jsx(ee,{open:F,onClose:()=>y(!1),children:a.jsxs("div",{className:"content w-100 mail",children:[a.jsx("p",{className:"header",children:"User Detail"}),a.jsx("div",{className:"modalbody",children:a.jsxs("form",{id:"form",onSubmit:x,children:[a.jsx(A,{required:!0,value:f.email,sx:{width:"98%"},label:"Email Id",disabled:!0,size:"small"}),a.jsx(A,{required:!0,value:f.message,onChange:e=>w(e,"message"),sx:{width:"98%"},multiline:!0,rows:8,label:"Message",size:"small"})]})}),a.jsxs("div",{className:"modalfooter",children:[a.jsx(k,{startIcon:a.jsx(xe,{}),form:"form",type:"submit",variant:"contained",children:" Send"}),a.jsx(k,{onClick:()=>{y(!1),u(n)},variant:"outlined",children:" cancel"})]})]})}),a.jsxs(M,{open:S,backdrop:3,onClose:()=>g(!1),width:420,animation:!0,children:[a.jsx(M.Header,{children:a.jsx("p",{className:"header",children:"User Detail"})}),a.jsx(M.Body,{children:a.jsxs("form",{id:"form",onSubmit:j,children:[a.jsx(A,{required:!0,value:l.name,onChange:e=>b(e,"name"),sx:{width:"98%"},label:"Name",size:"small"}),a.jsx(A,{type:"tel",required:!0,value:l.phone,onChange:e=>b(e,"phone"),sx:{width:"98%"},label:"Mobile",onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},size:"small"}),a.jsxs(L,{sx:{width:"98%"},size:"small",children:[a.jsx(O,{id:"demo-simple-select-label",children:"Verify"}),a.jsxs(q,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.isverified,label:"status",onChange:e=>b(e,"isverified"),children:[a.jsx(D,{value:!0,children:"Yes"}),a.jsx(D,{value:!1,children:"No"})]})]}),a.jsxs(L,{sx:{width:"98%"},size:"small",children:[a.jsx(O,{id:"demo-simple-select-label",children:"Admin"}),a.jsxs(q,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.isadmin,label:"status",onChange:e=>b(e,"isadmin"),children:[a.jsx(D,{value:!0,children:"Yes"}),a.jsx(D,{value:!1,children:"No"})]})]})]})}),a.jsxs(M.Footer,{children:[a.jsx(k,{startIcon:a.jsx(ae,{}),form:"form",type:"submit",variant:"contained",children:" Update"}),a.jsx(k,{onClick:()=>{g(!1),h(p)},variant:"outlined",children:" cancel"})]})]})]})})};export{Ce as default};
