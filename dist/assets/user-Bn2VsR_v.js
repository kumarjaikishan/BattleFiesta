import{a2 as W,j as a,a4 as _,a3 as Y,r as v,V as J,_ as V,X as k,s as E,Z as X,$ as G,aq as K,ar as P,as as Q,u as U,a as Z,b as ee,a9 as ae,aa as se,at as B,Q as c,ab as te,T as M,B as z,f as L,g as T,S as q,h as F,ah as oe,au as le,aj as re,av as ne,ak as ie}from"./index-DCoPaP0g.js";import{R as ce}from"./index-DaXFE_2U.js";import{X as de,u as me}from"./AllDbModal-XDu4G56T.js";const ue=W(a.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function pe(s){return _("MuiAvatar",s)}Y("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const he=["alt","children","className","component","imgProps","sizes","src","srcSet","variant"],fe=s=>{const{classes:o,variant:r,colorDefault:n}=s;return G({root:["root",r,n&&"colorDefault"],img:["img"],fallback:["fallback"]},pe,o)},ge=E("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:r}=s;return[o.root,o[r.variant],r.colorDefault&&o.colorDefault]}})(({theme:s})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:s.typography.fontFamily,fontSize:s.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(s.vars||s).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:k({color:(s.vars||s).palette.background.default},s.vars?{backgroundColor:s.vars.palette.Avatar.defaultBg}:k({backgroundColor:s.palette.grey[400]},s.applyStyles("dark",{backgroundColor:s.palette.grey[600]})))}]})),xe=E("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(s,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),ve=E(ue,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(s,o)=>o.fallback})({width:"75%",height:"75%"});function ye({crossOrigin:s,referrerPolicy:o,src:r,srcSet:n}){const[d,l]=v.useState(!1);return v.useEffect(()=>{if(!r&&!n)return;l(!1);let m=!0;const i=new Image;return i.onload=()=>{m&&l("loaded")},i.onerror=()=>{m&&l("error")},i.crossOrigin=s,i.referrerPolicy=o,i.src=r,n&&(i.srcset=n),()=>{m=!1}},[s,o,r,n]),d}const be=v.forwardRef(function(o,r){const n=J({props:o,name:"MuiAvatar"}),{alt:d,children:l,className:m,component:i="div",imgProps:f,sizes:y,src:b,srcSet:j,variant:u="circular"}=n,x=V(n,he);let C=null;const w=ye(k({},f,{src:b,srcSet:j})),I=b||j,D=I&&w!=="error",S=k({},n,{colorDefault:!D,component:i,variant:u}),N=fe(S);return D?C=a.jsx(xe,k({alt:d,srcSet:j,src:b,sizes:y,ownerState:S,className:N.img},f)):l!=null&&l!==""&&typeof l!="boolean"?C=l:I&&d?C=d[0]:C=a.jsx(ve,{ownerState:S,className:N.fallback}),a.jsx(ge,k({as:i,ownerState:S,className:X(N.root,m),ref:r},x,{children:C}))});function je(s){return K({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M17.187 19.181L24 4.755 0 12.386l9.196 1.963.043 4.896 2.759-2.617-2.147-2.076 7.336 4.63z"},child:[]}]})(s)}const g=({open:s,onClose:o,tapOutsidemodal:r=!1,children:n,shadow:d=!0,animation:l=!1,width:m=400,backdrop:i=0})=>{if(v.useEffect(()=>{if(s){const x=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflowY="hidden",document.body.style.paddingRight=`${x}px`,()=>{setTimeout(()=>{document.body.style.overflowY="scroll",document.body.style.paddingRight="0px"},100)}}},[s]),!s)return null;const f=P.Children.toArray(n).find(u=>u.type===g.Header),y=P.Children.toArray(n).find(u=>u.type===g.Body),b=P.Children.toArray(n).find(u=>u.type===g.Footer),j=i>0?`blur(${i}px)`:"none";return Q.createPortal(a.jsx("div",{className:"modal",onClick:r?o:void 0,style:{backdropFilter:j},children:a.jsx("div",{style:{width:m,...d&&{boxShadow:"0 10px 20px rgba(0,0,0,0.4)"}},onClick:u=>u.stopPropagation(),className:`modalbox ${l&&"animation"}`,children:a.jsxs("div",{className:"wrapper",children:[f,y,b]})})}),document.body)};g.Header=({children:s})=>a.jsx("div",{className:"modal-header",children:s});g.Body=({children:s})=>a.jsx("div",{className:"modal-body",children:s});g.Footer=({children:s})=>a.jsx("div",{className:"modal-footer",children:s});const ke=()=>{const s=U(e=>e.admin),o=U(e=>e.admin),r=Z(),n=ee(),d={id:"",name:"",phone:"",isverified:"",isadmin:""},[l,m]=v.useState(d),i={email:"",message:""},[f,y]=v.useState(i);v.useEffect(()=>{},[]);const b=e=>{const t={day:"2-digit",month:"short",year:"2-digit"};return new Date(e).toLocaleDateString("en-GB",t).replace(/(\d{2} \w{3}) (\d{2})/,"$1, $2")},j=async e=>{if(ie({title:"Are you sure?",icon:"warning",buttons:!0,dangerMode:!0}).then(async t=>{if(t){const p=c.loading("Please wait...");try{const h=localStorage.getItem("token"),A=await fetch("/api/deleteuser",{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({userid:e})}),$=await A.json();if(A.ok)r(B()),c.update(p,{render:$.message,type:"success",isLoading:!1,autoClose:2100});else return c.update(p,{render:$.message,type:"warn",isLoading:!1,autoClose:2100})}catch(h){c.update(p,{render:h.message,type:"warn",isLoading:!1,autoClose:5200}),console.log(h)}}}),!e)return c.warn("UserId cannot be blank")},[u,x]=v.useState(!1),[C,w]=v.useState(!1),I=async e=>{e.preventDefault();try{const t=localStorage.getItem("token"),p=await fetch("/api/editUser",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),h=await p.json();x(!1),p.status==200?(r(B()),m(d),c.success(h.message,{autoClose:1300})):c.warn(h.message,{autoClose:1500})}catch(t){c.error(t.message,{autoClose:1900}),console.log(t),x(!1)}},D=async e=>{e.preventDefault();const t=f.message.replace(/\n/g,"<br />");try{const p=localStorage.getItem("token"),h=await fetch("/api/emailsend",{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({email:f.email,reply:t})}),A=await h.json();w(!1),h.status==200?(y(i),c.success(A.message,{autoClose:1300})):c.warn(A.message,{autoClose:1500})}catch(p){console.log(p),w(!1),c.error(p.message,{autoClose:1900})}},S=e=>{m({id:e._id,name:e.name,phone:e.phone,isverified:e.isverified,isadmin:e.isadmin}),x(!0)},N=e=>{y({email:e.email,message:""}),w(!0)},R=(e,t)=>{m({...l,[t]:e.target.value})},O=(e,t)=>{y({...f,[t]:e.target.value})},H=[{name:"S.no",selector:(e,t)=>t+1,width:"50px"},{name:"Name",cell:e=>{var t;return a.jsxs(le,{onClick:()=>n(`/channel/@${e.username}`),sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer","&:hover span":{color:"primary.main"}},children:[a.jsx(be,{src:e.imgsrc,alt:e.name,sx:{width:32,height:32},children:!e.imgsrc&&((t=e.name)==null?void 0:t[0])}),a.jsx("span",{children:e.name})]})}},{name:"Mobile",selector:e=>e.phone},{name:"Email",selector:e=>e.email},{name:"Date",selector:e=>b(e.createdAt),width:"80px"},{name:"Member Stat",selector:e=>{var t;return(t=e==null?void 0:e.membership)!=null&&t.isActive?"✅ Active":"❌ Expired"},width:"100px"},{name:"Action",cell:e=>a.jsxs("div",{className:"flex gap-2 lg:gap-1",children:[a.jsx(re,{className:"editicon ico",title:"Edit",onClick:()=>S(e)}),a.jsx(ne,{className:"printicon ico",title:"Mail",onClick:()=>N(e)}),a.jsx(ce,{className:"deleteicon ico",title:"Delete",onClick:()=>j(e._id)})]}),width:"120px",ignoreRowClick:!0}];return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"adminusers p-1",children:[a.jsxs("div",{className:"controler flex flex-col items-center gap-2 py-[5px] sm:flex-row sm:justify-between",children:[a.jsx("h2",{className:"text-center text-xl font-semibold sm:text-left",children:"Users"}),a.jsx(ae,{loading:o.loading,onClick:async()=>{try{await r(B()).unwrap(),c.success("Refreshed!",{autoClose:900})}catch{c.error("Failed to refresh!")}},loadingPosition:"end",endIcon:a.jsx(se,{}),variant:"outlined",type:"submit",size:"small",children:"REFRESH"})]}),a.jsx(de,{columns:H,data:s==null?void 0:s.users,pagination:!0,highlightOnHover:!0,customStyles:me()}),a.jsx(te,{open:C,onClose:()=>w(!1),children:a.jsxs("div",{className:"content w-100 mail",children:[a.jsx("p",{className:"header",children:"User Detail"}),a.jsx("div",{className:"modalbody",children:a.jsxs("form",{id:"form",onSubmit:D,children:[a.jsx(M,{required:!0,value:f.email,sx:{width:"98%"},label:"Email Id",disabled:!0,size:"small"}),a.jsx(M,{required:!0,value:f.message,onChange:e=>O(e,"message"),sx:{width:"98%"},multiline:!0,rows:8,label:"Message",size:"small"})]})}),a.jsxs("div",{className:"modalfooter",children:[a.jsx(z,{startIcon:a.jsx(je,{}),form:"form",type:"submit",variant:"contained",children:" Send"}),a.jsx(z,{onClick:()=>{w(!1),y(i)},variant:"outlined",children:" cancel"})]})]})}),a.jsxs(g,{open:u,backdrop:3,onClose:()=>x(!1),width:420,animation:!0,children:[a.jsx(g.Header,{children:a.jsx("p",{className:"header",children:"User Detail"})}),a.jsx(g.Body,{children:a.jsxs("form",{id:"form",onSubmit:I,children:[a.jsx(M,{required:!0,value:l.name,onChange:e=>R(e,"name"),sx:{width:"98%"},label:"Name",size:"small"}),a.jsx(M,{type:"tel",required:!0,value:l.phone,onChange:e=>R(e,"phone"),sx:{width:"98%"},label:"Mobile",onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},size:"small"}),a.jsxs(L,{sx:{width:"98%"},size:"small",children:[a.jsx(T,{id:"demo-simple-select-label",children:"Verify"}),a.jsxs(q,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.isverified,label:"status",onChange:e=>R(e,"isverified"),children:[a.jsx(F,{value:!0,children:"Yes"}),a.jsx(F,{value:!1,children:"No"})]})]}),a.jsxs(L,{sx:{width:"98%"},size:"small",children:[a.jsx(T,{id:"demo-simple-select-label",children:"Admin"}),a.jsxs(q,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.isadmin,label:"status",onChange:e=>R(e,"isadmin"),children:[a.jsx(F,{value:!0,children:"Yes"}),a.jsx(F,{value:!1,children:"No"})]})]})]})}),a.jsxs(g.Footer,{children:[a.jsx(z,{startIcon:a.jsx(oe,{}),form:"form",type:"submit",variant:"contained",children:" Update"}),a.jsx(z,{onClick:()=>{x(!1),m(d)},variant:"outlined",children:" cancel"})]})]})]})})};export{ke as default};
