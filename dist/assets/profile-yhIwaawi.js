import{u as H,a as K,b as Y,r as g,s as J,j as e,H as Q,m as T,c as F,B as m,I as M,T as o,d as N,M as V,N as X,e as Z,F as ee,f as ae,g as se,S as ne,h,C as ie,i as le,k as te,L as re,l as oe,n as ce,o as de,p as pe,q as me,Q as r,t as _,v as ue}from"./index-e05NMAmt.js";import"./dayjs.min-KQjLVZRB.js";const je=()=>{const c=H(a=>a.userprofile),k=K(),{handleImage:w}=ue(),B=Y(),C="https://res.cloudinary.com/dusxlxlvm/image/upload/v1718950087/battlefiesta/assets/icon/user_p5egd9.webp",E={name:"",username:"",email:"",phone:"",city:"",state:"",bio:"",publicemail:"",publicphone:"",profile:"",cover:"",sociallinks:[]},[n,j]=g.useState(E),[b,$]=g.useState(""),[d,R]=g.useState({plan:"N/A",planprice:"N/A",buydate:"N/A",expirydate:"N/A",expire_in:"N/A",status:"N/A",tournament:"N/A"});g.useEffect(()=>{c.userprofile&&O()},[c]);const I=J("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),O=async()=>{if(!c.membership)return;let a=c.userprofile,s=c.membership;j({...n,name:a.name,username:a.username,email:a.email,phone:a.phone,city:a.city,state:a.state,bio:a.bio,publicemail:a.publicemail,publicphone:a.publicphone,sociallinks:a.sociallinks,profile:a.imgsrc,cover:a.coversrc}),c.membership.planid.plan_name&&R({plan:s.planid.plan_name,planprice:s.planid.price,tournament:s.planid.create_limit>500?"Unlimited":s.planid.create_limit,buydate:s.buy_date,expirydate:s.expire_date,expire_in:G(s.expire_date),status:s.isActive?"active":"expired"})},U=()=>{let a={name:"",link:""};j({...n,sociallinks:[...n.sociallinks,a]})},q=a=>{let s=n.sociallinks.filter((i,l)=>l!=a);j({...n,sociallinks:s})},P=(a,s)=>{const i=a.target.name,l=a.target.value,t=[...n.sociallinks];t[s]={...t[s],[i]:l},j({...n,sociallinks:t})},u=a=>{const s=a.target.name,i=a.target.value;j({...n,[s]:i})},[x,p]=g.useState(!1),v=async a=>{a.preventDefault(),p(!0);const s=r.loading("Please wait...");try{const i=localStorage.getItem("token"),l=await fetch("/api/updateprofile",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await l.json();if(console.log(t),p(!1),!l.ok)return r.update(s,{render:t.message,type:"warning",isLoading:!1,autoClose:1600});k(_()),r.update(s,{render:t.message,type:"success",isLoading:!1,autoClose:1600})}catch(i){r.update(s,{render:i.message,type:"warn",isLoading:!1,autoClose:1600}),console.log(i),p(!1)}},S=async(a,s)=>{const i=a.target.files[0];let l,t;if(s=="profile"?(l=await w(230,i),t="/api/updateprofilepic"):(l=await w(600,i),t="/api/updatecoverpic"),l){const y=r.loading("Uploading Please wait...");p(!0);try{const f=localStorage.getItem("token"),z=new FormData;z.append(s==="profile"?"profilepic":"coverpic",l);const D=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:z}),A=await D.json();if(p(!1),D.ok){r.update(y,{render:A.message,type:"success",isLoading:!1,autoClose:1600}),k(_());return}r.update(y,{render:A.message,type:"warning",isLoading:!1,autoClose:1600})}catch(f){r.update(y,{render:f.message,type:"warning",isLoading:!1,autoClose:1600}),console.log(f),p(!1)}}},W=async()=>{try{p(!0);const a=r.loading("Please wait..."),s=localStorage.getItem("token"),i=await fetch("/api/passreset",{method:"Get",headers:{Authorization:`Bearer ${s}`}}),l=await i.json();if(p(!1),!i.ok)return r.update(a,{render:l.message,type:"warn",isLoading:!1,autoClose:2100});$(l.extramessage),r.update(a,{render:l.message,type:"success",isLoading:!1,autoClose:2100})}catch(a){r.update(id,{render:a.message,type:"warn",isLoading:!1,autoClose:2200}),p(!1),console.log(a)}},L=a=>{const s={day:"2-digit",month:"short",year:"numeric"};return new Date(a).toLocaleDateString("en-GB",s)};function G(a){const l=new Date(a)-new Date;return Math.floor(l/(1e3*60*60*24))+1}return e.jsxs("div",{className:"profilepage",children:[e.jsxs(Q,{children:[e.jsxs("title",{children:[n.name," | Profile"]}),e.jsx("link",{rel:"canonical",href:`${window.location.origin}/profile`}),e.jsx("meta",{name:"description",content:"Manage your BattleFiesta profile, update personal details, track tournament history, and customize settings for a better gaming experience."})]}),e.jsx(T.div,{animate:{scale:[1,1.2,1.2,1],rotate:[0,90,90,0],borderRadius:["10%","20%","40%","10%"]},transition:{duration:8,ease:"easeInOut",repeat:1/0},className:"circle circle1"}),e.jsx(T.div,{animate:{scale:[1,1.1,1.1,1]},transition:{duration:4,repeat:1/0},className:"circle circle2"}),e.jsxs("div",{className:"materials",children:[e.jsxs("div",{className:"profilepic glass",children:[e.jsx("h2",{children:"Profile Picture"}),e.jsxs("div",{className:"coverimg",children:[e.jsx("img",{src:F(n==null?void 0:n.cover,{format:"webp"})||C,loading:"lazy",alt:"cover picture"}),e.jsx("div",{className:"img",children:e.jsx("img",{src:F(n==null?void 0:n.profile,{format:"webp",width:150,height:150})||C,loading:"lazy",alt:"profile picture"})})]}),e.jsxs(m,{component:"label",sx:{mt:6},disabled:x,role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(M,{}),className:"splbtn",children:["Change Cover",e.jsx(I,{onChange:a=>S(a,"cover"),type:"file",accept:"image/*"})]}),e.jsxs(m,{component:"label",sx:{mt:1},disabled:x,role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(M,{}),className:"splbtn",children:["Change Profile",e.jsx(I,{onChange:a=>S(a,"profile"),type:"file",accept:"image/*"})]})]}),e.jsxs("div",{className:"profiledeatil glass",children:[e.jsx("h2",{children:"Profile"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"input",children:[e.jsx(o,{size:"small",onChange:u,name:"name",value:n.name||"",className:"half",label:"Display Name",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"username",value:n.username||"",className:"half",label:"UserName",variant:"outlined"}),e.jsx(o,{size:"small",contentEditable:!1,disabled:!0,name:"email",value:n.email||"",className:"half",label:"Email",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"phone",value:n.phone||"",type:"tel",inputProps:{minLength:10,maxLength:10},onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},className:"half",label:"Phone",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"city",value:n.city,className:"half",label:"City",variant:"outlined"}),e.jsx(o,{size:"small",onChange:u,name:"state",value:n.state,className:"half",label:"State",variant:"outlined"}),e.jsx(o,{onChange:u,name:"bio",value:n.bio,multiline:!0,rows:2,className:"full textarea",label:"Bio/About",variant:"outlined"})]}),e.jsx(m,{disabled:x,variant:"contained",startIcon:e.jsx(N,{}),className:"splbtn",type:"submit",size:"small",children:"Save"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(V,{}),className:"splbtn",size:"small",sx:{marginLeft:1},onClick:()=>{var a;return B(`/channel/@${(a=c==null?void 0:c.userprofile)==null?void 0:a.username}`)},children:"Public Profile"})]})]}),e.jsxs("div",{className:"membership glass",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{children:" Plan"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:[d.plan," Plan"]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Plan price"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:["₹ ",d.planprice,".00"]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Tournament"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{children:d.tournament})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Buy Date"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{children:L(d.buydate)})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Expiry Date"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{children:[L(d.expirydate)," "]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Expire In"})," ",e.jsx("span",{children:":"})," ",e.jsxs("span",{style:{color:d.expire_in<6&&"red"},children:[d.expire_in," Days "]})," "]}),e.jsxs("p",{children:[e.jsx("span",{children:" Status"})," ",e.jsx("span",{children:":"})," ",e.jsx("span",{className:`status ${d.status}`,children:d.status})," "]}),e.jsxs(X,{className:"navlink",to:"/subscription",children:["  ",e.jsx(m,{variant:"contained",className:"splbtn",startIcon:e.jsx(Z,{}),children:"Buy Membership"})]})]})]}),e.jsxs("div",{className:"passchange glass",children:[e.jsx("h2",{children:"Change Password"}),e.jsxs("div",{children:[e.jsx(o,{required:!0,name:"link",InputProps:{readOnly:!0},fullWidth:!0,size:"small",value:n.email,className:"half",label:"Email Address",variant:"outlined"}),b&&e.jsx("p",{style:{color:"green",fontSize:"14px"},children:b}),!b.length&&e.jsxs("p",{style:{fontSize:"14px"},children:["A verification email will be sent to ",e.jsx("b",{children:n.email}),"."]}),e.jsx(m,{disabled:x,onClick:W,title:"Send Password Reset Link",variant:"contained",className:"splbtn",startIcon:e.jsx(ee,{}),children:"Send Password Reset Link"})]})]}),e.jsxs("div",{className:"privacy glass",children:[e.jsx("h2",{children:"Privacy"}),e.jsxs("div",{className:"input",children:[e.jsx(o,{onChange:u,name:"publicemail",value:n.publicemail||"",className:"full",helperText:"This emaill will be visible on your profile page",label:"Public Email",variant:"outlined"}),e.jsx(o,{onChange:u,type:"tel",inputProps:{minLength:10,maxLength:10},onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},name:"publicphone",value:n.publicphone||"",className:"full",helperText:"This phone number will be visible on your profile page",label:"Public Phone",variant:"outlined"})]}),e.jsx(m,{disabled:x,variant:"contained",startIcon:e.jsx(N,{}),className:"splbtn",onClick:v,size:"small",children:"Save"})]}),e.jsxs("div",{className:"social glass",children:[e.jsx("h2",{children:"Social Links"}),e.jsxs("form",{onSubmit:v,children:[n.sociallinks&&n.sociallinks.map((a,s)=>e.jsxs("div",{className:"link",children:[e.jsx("span",{children:e.jsxs(ae,{fullWidth:!0,size:"small",children:[e.jsx(se,{children:"Name*"}),e.jsxs(ne,{labelId:"demo-simple-select-label",value:a.name,required:!0,label:"Name",name:"name",onChange:i=>P(i,s),children:[e.jsxs(h,{value:"facebook",children:[e.jsx(ie,{}),"   Facebook"]}),e.jsxs(h,{value:"youtube",children:[e.jsx(le,{}),"   Youtube"]}),e.jsxs(h,{value:"instagram",children:[e.jsx(te,{}),"  Instagram"]}),e.jsxs(h,{value:"discord",children:[e.jsx(re,{}),"  Discord"]}),e.jsxs(h,{value:"telegram",children:[e.jsx(oe,{}),"  Telegram"]}),e.jsxs(h,{value:"twitter",children:[e.jsx(ce,{}),"  Twitter"]}),e.jsxs(h,{value:"website",children:[e.jsx(de,{}),"  Website"]})]})]})}),e.jsx("span",{children:e.jsx(o,{required:!0,value:a.link,name:"link",fullWidth:!0,size:"small",onChange:i=>P(i,s),className:"half",label:"Url",variant:"outlined"})}),e.jsxs("span",{title:"Remove This",onClick:()=>q(s),children:[" ",e.jsx(pe,{})," "]})]},s)),e.jsx("div",{children:e.jsx(m,{variant:"outlined",onClick:U,startIcon:e.jsx(me,{}),children:"Add"})}),e.jsx(m,{disabled:x,variant:"contained",startIcon:e.jsx(N,{}),className:"splbtn",type:"submit",size:"small",children:"Save"})]})]})]})]})};export{je as default};
