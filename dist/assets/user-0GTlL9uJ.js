import{a1 as _,j as a,a3 as H,a2 as J,s as F,_ as b,r as g,V as G,W as V,Z as W,$ as X,as as Y,u as E,a as K,b as Q,a8 as Z,at as P,Q as r,a9 as ee,aa as L,T as D,f as U,g as $,S as T,h as M,B as R,ag as ae,au as se,ai as te,av as oe,aj as ne}from"./index-YXKoBC_c.js";import{R as le}from"./index-Aejah5LC.js";import{X as ie,u as re}from"./AllDbModal-pcvPQI-R.js";const ce=_(a.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function de(s){return H("MuiAvatar",s)}J("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const me=["alt","children","className","component","imgProps","sizes","src","srcSet","variant"],ue=s=>{const{classes:o,variant:l,colorDefault:c}=s;return X({root:["root",l,c&&"colorDefault"],img:["img"],fallback:["fallback"]},de,o)},he=F("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:l}=s;return[o.root,o[l.variant],l.colorDefault&&o.colorDefault]}})(({theme:s})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:s.typography.fontFamily,fontSize:s.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(s.vars||s).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:b({color:(s.vars||s).palette.background.default},s.vars?{backgroundColor:s.vars.palette.Avatar.defaultBg}:b({backgroundColor:s.palette.grey[400]},s.applyStyles("dark",{backgroundColor:s.palette.grey[600]})))}]})),pe=F("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(s,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),ge=F(ce,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(s,o)=>o.fallback})({width:"75%",height:"75%"});function fe({crossOrigin:s,referrerPolicy:o,src:l,srcSet:c}){const[u,n]=g.useState(!1);return g.useEffect(()=>{if(!l&&!c)return;n(!1);let h=!0;const i=new Image;return i.onload=()=>{h&&n("loaded")},i.onerror=()=>{h&&n("error")},i.crossOrigin=s,i.referrerPolicy=o,i.src=l,c&&(i.srcset=c),()=>{h=!1}},[s,o,l,c]),u}const xe=g.forwardRef(function(o,l){const c=G({props:o,name:"MuiAvatar"}),{alt:u,children:n,className:h,component:i="div",imgProps:p,sizes:j,src:C,srcSet:S,variant:z="circular"}=c,f=V(c,me);let x=null;const v=fe(b({},p,{src:C,srcSet:S})),A=C||S,I=A&&v!=="error",y=b({},c,{colorDefault:!I,component:i,variant:z}),w=ue(y);return I?x=a.jsx(pe,b({alt:u,srcSet:S,src:C,sizes:j,ownerState:y,className:w.img},p)):n!=null&&n!==""&&typeof n!="boolean"?x=n:A&&u?x=u[0]:x=a.jsx(ge,{ownerState:y,className:w.fallback}),a.jsx(he,b({as:i,ownerState:y,className:W(w.root,h),ref:l},f,{children:x}))}),ve=xe;function je(s){return Y({tag:"svg",attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M17.187 19.181L24 4.755 0 12.386l9.196 1.963.043 4.896 2.759-2.617-2.147-2.076 7.336 4.63z"},child:[]}]})(s)}const Se=()=>{const s=E(e=>e.admin),o=E(e=>e.admin),l=K(),c=Q(),u={id:"",name:"",phone:"",isverified:"",isadmin:""},[n,h]=g.useState(u),i={email:"",message:""},[p,j]=g.useState(i);g.useEffect(()=>{console.log(s.users)},[]);const C=e=>{const t={day:"2-digit",month:"short",year:"2-digit"};return new Date(e).toLocaleDateString("en-GB",t).replace(/(\d{2} \w{3}) (\d{2})/,"$1, $2")},S=async e=>{if(ne({title:"Are you sure?",icon:"warning",buttons:!0,dangerMode:!0}).then(async t=>{if(t){const d=r.loading("Please wait...");try{const m=localStorage.getItem("token"),k=await fetch("/api/deleteuser",{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({userid:e})}),B=await k.json();if(k.ok)l(P()),r.update(d,{render:B.message,type:"success",isLoading:!1,autoClose:2100});else return r.update(d,{render:B.message,type:"warn",isLoading:!1,autoClose:2100})}catch(m){r.update(d,{render:m.message,type:"warn",isLoading:!1,autoClose:5200}),console.log(m)}}}),!e)return r.warn("UserId cannot be blank")},[z,f]=g.useState(!1),[x,v]=g.useState(!1),A=async e=>{e.preventDefault();try{const t=localStorage.getItem("token"),d=await fetch("/api/editUser",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),m=await d.json();f(!1),d.status==200?(l(P()),h(u),r.success(m.message,{autoClose:1300})):r.warn(m.message,{autoClose:1500})}catch(t){r.error(t.message,{autoClose:1900}),console.log(t),f(!1)}},I=async e=>{e.preventDefault();const t=p.message.replace(/\n/g,"<br />");try{const d=localStorage.getItem("token"),m=await fetch("/api/emailsend",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({email:p.email,reply:t})}),k=await m.json();v(!1),m.status==200?(j(i),r.success(k.message,{autoClose:1300})):r.warn(k.message,{autoClose:1500})}catch(d){console.log(d),v(!1),r.error(d.message,{autoClose:1900})}},y=e=>{h({id:e._id,name:e.name,phone:e.phone,isverified:e.isverified,isadmin:e.isadmin}),f(!0)},w=e=>{j({email:e.email,message:""}),v(!0)},N=(e,t)=>{h({...n,[t]:e.target.value})},O=(e,t)=>{j({...p,[t]:e.target.value})},q=[{name:"S.no",selector:(e,t)=>t+1,width:"50px"},{name:"Name",cell:e=>{var t;return a.jsxs(se,{onClick:()=>c(`/channel/@${e.username}`),sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer","&:hover span":{color:"primary.main"}},children:[a.jsx(ve,{src:e.imgsrc,alt:e.name,sx:{width:32,height:32},children:!e.imgsrc&&((t=e.name)==null?void 0:t[0])}),a.jsx("span",{children:e.name})]})}},{name:"Mobile",selector:e=>e.phone},{name:"Email",selector:e=>e.email},{name:"Date",selector:e=>C(e.createdAt),width:"80px"},{name:"Member Stat",selector:e=>{var t;return(t=e==null?void 0:e.membership)!=null&&t.isActive?"✅ Active":"❌ Expired"},width:"100px"},{name:"Action",cell:e=>a.jsxs("span",{children:[a.jsx(te,{className:"editicon ico",title:"Edit",onClick:()=>y(e)}),a.jsx(oe,{className:"printicon ico",title:"Mail",onClick:()=>w(e)}),a.jsx(le,{className:"deleteicon ico",title:"Delete",onClick:()=>S(e._id)})]}),width:"120px",ignoreRowClick:!0,allowOverflow:!0,button:!0}];return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"adminusers",children:[a.jsxs("div",{className:"controler",children:[a.jsx("h2",{style:{textAlign:"center"},children:"Users"}),a.jsx(Z,{loading:o.loading,onClick:async()=>{try{await l(P()).unwrap(),r.success("Refreshed!",{autoClose:900})}catch{r.error("Failed to refresh!")}},loadingPosition:"end",endIcon:a.jsx(ee,{}),variant:"outlined",type:"submit",size:"small",className:"refreshe",children:"REFRESH"})]}),a.jsx(ie,{columns:q,data:s==null?void 0:s.users,pagination:!0,highlightOnHover:!0,customStyles:re()}),a.jsx(L,{open:z,onClose:()=>f(!1),children:a.jsx("div",{className:"membermodal",children:a.jsxs("form",{onSubmit:A,children:[a.jsx("h2",{children:"User Detail"}),a.jsxs("span",{className:"modalcontent",children:[a.jsx(D,{required:!0,value:n.name,onChange:e=>N(e,"name"),sx:{width:"98%"},label:"Name",size:"small"}),a.jsx(D,{type:"tel",required:!0,value:n.phone,onChange:e=>N(e,"phone"),sx:{width:"98%"},label:"Mobile",onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},size:"small"}),a.jsxs(U,{sx:{width:"98%"},size:"small",children:[a.jsx($,{id:"demo-simple-select-label",children:"Verify"}),a.jsxs(T,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:n.isverified,label:"status",onChange:e=>N(e,"isverified"),children:[a.jsx(M,{value:!0,children:"Yes"}),a.jsx(M,{value:!1,children:"No"})]})]}),a.jsxs(U,{sx:{width:"98%"},size:"small",children:[a.jsx($,{id:"demo-simple-select-label",children:"Admin"}),a.jsxs(T,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:n.isadmin,label:"status",onChange:e=>N(e,"isadmin"),children:[a.jsx(M,{value:!0,children:"Yes"}),a.jsx(M,{value:!1,children:"No"})]})]}),a.jsxs("div",{style:{width:"100%"},children:[a.jsx(R,{startIcon:a.jsx(ae,{}),type:"submit",variant:"contained",children:" Update"}),a.jsx(R,{onClick:()=>{f(!1),h(u)},variant:"outlined",children:" cancel"})]})]})]})})}),a.jsx(L,{open:x,onClose:()=>v(!1),children:a.jsx("div",{className:"membermodal mail",children:a.jsxs("form",{onSubmit:I,children:[a.jsx("h2",{children:"Send Email"}),a.jsxs("span",{className:"modalcontent",children:[a.jsx(D,{required:!0,value:p.email,sx:{width:"98%"},label:"Email Id",disabled:!0,size:"small"}),a.jsx(D,{required:!0,value:p.message,onChange:e=>O(e,"message"),sx:{width:"98%"},multiline:!0,rows:8,label:"Message",size:"small"}),a.jsxs("div",{style:{width:"100%"},children:[a.jsx(R,{startIcon:a.jsx(je,{}),type:"submit",variant:"contained",children:" Send"}),a.jsx(R,{onClick:()=>{v(!1),j(i)},variant:"outlined",children:" cancel"})]})]})]})})})]})})};export{Se as default};
